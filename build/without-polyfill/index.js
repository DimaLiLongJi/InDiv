"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var easierCookie=_interopDefault(require("easier-cookie"));require("reflect-metadata");var axios=_interopDefault(require("axios")),rxjs=_interopDefault(require("rxjs"));function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var bundle=createCommonjsModule(function(e,t){function n(e){return e&&"object"===_typeof(e)&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=n(easierCookie),o=n(axios),i=function(){function e(){this.toString=Object.prototype.toString}return e.prototype.setCookie=function(e,t,n){r.set(e,t,n)},e.prototype.getCookie=function(e){return r.get(e)},e.prototype.removeCookie=function(e){return r.remove(e)},e.prototype.buildQuery=function(e){if(!(e&&e instanceof Object))return"";var t="?";for(var n in e)e[n]instanceof Object?t+=n+"="+JSON.stringify(e[n])+"&":t+=n+"="+e[n].toString()+"&";return t.slice(0,t.length-1)},e.prototype.getQuery=function(e){for(var t=window.location.search.replace("?","").split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("=");n[o[0]]=o[1]}return n[e]?n[e]:""},e.prototype.isFunction=function(e){return"[object Function]"===this.toString.call(e)},e.prototype.isEqual=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=_typeof(e);return("function"===o||"object"===o||"object"===_typeof(t))&&this.deepIsEqual(e,t,n,r)},e.prototype.deepIsEqual=function(e,t,n,r){var o=this.toString.call(e);if(o!==this.toString.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var i="[object Array]"===o;if(!i){if("object"!==_typeof(e)||"object"!==_typeof(t))return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(this.isFunction(a)&&a instanceof a&&this.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),i){if((u=e.length)!==t.length)return!1;for(;u--;)if(!this.isEqual(e[u],t[u],n,r))return!1}else{var c=Object.keys(e),p=void 0;if(u=c.length,Object.keys(t).length!==u)return!1;for(;u--;)if(p=c[u],!t.hasOwnProperty(p)||!this.isEqual(e[p],t[p],n,r))return!1}return n.pop(),r.pop(),!0},e.prototype.formatInnerHTML=function(e){return e=(e=e.replace(/(\n\s*)/g,"")).replace(/^[^\S\n]+/gm,"")},e.prototype.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(),a=new i,s=function(){function e(e,t,n){this.data=e,this.watcher=t,this.render=n,this.watchData(this.data)}return e.prototype.watchData=function(t){if(t&&"object"===_typeof(t)){var r=this,e=function(e){var n=t[e];r.watchData(n),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return n},set:function(e){var t;a.isEqual(e,n)||(r.watcher&&(t=JSON.parse(JSON.stringify(r.data))),n=e,r.watchData(n),r.watcher&&r.watcher(t),r.render&&r.render())}})};for(var n in t)e(n)}},e}(),u=new i,c=function(){function e(e,t,n){this.data=e,this.key=t,this.watcher=n,this.watchData(this.data,this.key)}return e.prototype.watchData=function(e,t){if(e&&"object"===_typeof(e)&&e[t]){var n=this,r=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){var t;u.isEqual(e,r)||(n.watcher&&("object"===_typeof(r)&&(t=JSON.parse(JSON.stringify(r))),"object"!==_typeof(r)&&"function"!=typeof r&&(t=r)),r=e,n.watcher&&n.watcher(t))}})}},e}(),p=function(e){this.tagName=e.tagName,this.node=e.node,this.parentNode=e.parentNode,this.attributes=e.attributes,this.childNodes=e.childNodes,this.nodeValue=e.nodeValue,this.type=e.type,this.value=e.value,this.repeatData=e.repeatData,this.eventTypes=e.eventTypes,this.key=e.key,this.checked=!1};function l(e,t){var n,r,o,i,a,s,u=[];return e.childNodes&&Array.from(e.childNodes).forEach(function(e){u.push(l(e,t))}),new p({tagName:e.tagName,node:e,parentNode:e.parentNode,attributes:(r=e,o=t,i=r.attributes,a=[],s=o?o(r):null,i&&Array.from(i).forEach(function(e){s&&-1===s.indexOf(e.name)||a.push({name:e.name,value:e.value})}),a),childNodes:u,nodeValue:e.nodeValue,type:(n=e,1===n.nodeType?"element":3===n.nodeType?"text":11===n.nodeType?"document-fragment":""),value:e.value,repeatData:e.repeatData?e.repeatData:null,eventTypes:e.eventTypes?e.eventTypes:null,key:e.indiv_repeat_key?e.indiv_repeat_key:null})}function b(o,i,a,s){0<o.childNodes.length&&o.childNodes.forEach(function(t,e){if(!t.checked){var n=i.childNodes.find(function(e){return e.node.isEqualNode(t.node)&&e.key===t.key&&!e.checked||e.tagName===t.tagName&&e.key===t.key&&!e.checked});if(n){var r=i.childNodes.findIndex(function(e){return e===n});r!==e&&a.push({type:1,newIndex:r,oldVnode:t.node,parentNode:o.node}),d(t,n,a,s),n.checked=!0}else a.push({type:0,node:t.node,parentNode:o.node});t.checked=!0}}),0<i.childNodes.length&&i.childNodes.forEach(function(e,t){e.checked||(a.push({type:1,newIndex:t,oldVnode:e.node,parentNode:o.node}),e.checked=!0)})}function d(e,t,n,r){if(!n)throw new Error("patchList can not be null, diffVnode must need an Array");var o,i,a,s,u,c,p,l,d,h,f,v,m,y,g,$;"document-fragment"!==t.type?(o=e,a=n,(i=t).attributes.forEach(function(t){var e=o.attributes.find(function(e){return e.name===t.name});e&&e.value===t.value||a.push({type:2,node:o.node,newValue:t,oldValue:e})}),o.attributes.forEach(function(t){i.attributes.find(function(e){return e.name===t.name})||a.push({type:3,node:o.node,oldValue:t})}),u=t,c=n,(s=e).nodeValue!==u.nodeValue&&c.push({type:4,node:s.node,newValue:u.nodeValue,oldValue:s.nodeValue}),"INPUT"!==e.tagName&&"TEXTAREA textarea"!==e.tagName&&"INPUT"!==e.tagName||(l=t,d=n,(p=e).value!==l.value&&d.push({type:5,node:p.node,newValue:l.value,oldValue:p.value})),h=e,f=t,n.push({type:6,node:h.node,newValue:f.repeatData}),v=e,m=t,y=n,g=JSON.parse(v.eventTypes),($=JSON.parse(m.eventTypes))&&0<$.length&&$.forEach(function(e){y.push({type:7,node:v.node,eventType:e,newValue:m.node["event"+e]})}),g&&0<g.length&&g.forEach(function(t){(!$||$.length<=0)&&y.push({type:7,node:v.node,eventType:t,newValue:null}),$&&0<$.length&&!$.find(function(e){return e===t})&&y.push({type:7,node:v.node,eventType:t,newValue:null})}),y.push({type:8,node:v.node,newValue:m.eventTypes}),r&&!r(e,t)||b(e,t,n,r)):b(e,t,n,r)}var $=function(){function e(e){this.$fragment=e}return e.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").replace("$.","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},e.prototype._setValueByValue=function(e,t,n,r){var o,i=t.replace("()","").replace("$.","").split("."),a=e;i.forEach(function(e,t){if(e===n&&0===t)return o=e;t<i.length&&(o=e),t<i.length-1&&(a=a[e])}),o&&(a[o]=r)},e.prototype._getVMVal=function(e,t){var n=t.replace("()","").replace("$.","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMRepeatVal=function(n,e,r){var o;return e.replace("()","").replace("$.","").split(".").forEach(function(e,t){o=e!==r||0!==t?o[e]:n}),o},e.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMFunctionArguments=function(e,t,n,r,o){var i=t.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),a=[],s=this;return i.forEach(function(t){return""!==t&&("$element"===t?a.push(n):"true"===t||"false"===t?a.push("true"===t):/(\$\.).*/g.test(t)?a.push(s._getVMVal(e.state,t)):/\'.*\'/g.test(t)?a.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?a.push(Number(t)):0===t.indexOf(r)||0===t.indexOf(r+".")?a.push(s._getVMRepeatVal(o,t,r)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return a.push(s._getValueByValue(n.repeatData[e],t,e))})))}),a},e.prototype.bind=function(e,t,n,r,o,i,a,s){var u,c=e.repeatData[t];if(/^(\@)/.test(r)){if("model"===n)throw new Error("directive: nv-model can't use "+r+" as value");var p=this._getVMFunction(i,r),l=this._getVMFunctionArguments(i,r,e,t,s);u=p.apply(i,l)}else if(0===r.indexOf(t)||0===r.indexOf(t+"."))u=this._getVMRepeatVal(c,r,t);else if(/(\$\.).*/.test(r))u=this._getVMVal(i.state,r);else{if("$index"!==r)throw new Error("directive: nv-"+n+" can't use recognize this value "+r);u=o}e.hasChildNodes()||this.templateUpdater(e,c,t,i);var d=this[n+"Updater"];switch(n){case"model":var h=void 0;h=0===r.indexOf(t)||0===r.indexOf(t+".")?a:this._getVMVal(i.state,r),d&&d.call(this,e,u,r,t,o,h,i);break;case"text":case"html":case"if":case"class":case"key":d&&d.call(this,e,u);break;default:this.commonUpdater.call(this,e,u,n)}},e.prototype.templateUpdater=function(e,t,n,r){var o=e.textContent;if(/\{\{(.*)\}\}/g.test(o)){var i=o.match(/(\{\{[^\{\}]+?\}\})/g);if(i&&0<i.length)for(var a=0;a<i.length;a++){var s=i[a].replace("{{","").replace("}}",""),u=null;if(/^(\@)/.test(s)){var c=this._getVMFunction(r,s),p=this._getVMFunctionArguments(r,s,e,n,t);u=c.apply(r,p)}else if(0===s.indexOf(n)||0===s.indexOf(n+"."))u=this._getVMRepeatVal(t,s,n);else{if(!/(\$\.).*/.test(s))throw new Error("directive: {{"+s+"}} can't use recognize "+s);u=this._getVMVal(r.state,s)}e.textContent=e.textContent.replace(i[a],u)}}},e.prototype.modelUpdater=function(e,t,r,o,i,a,s){e.value=void 0===t?"":t;var u=this,n=function(e){if(e.preventDefault(),/(\$\.).*/.test(r)){var t=r.replace("$.","");if(e.target.value===a)return;s.state[t]=e.target.value}else{if(0!==r.indexOf(o)&&0!==r.indexOf(o+"."))throw new Error("directive: nv-model can't use recognize this value");if("object"!==_typeof(a[i])&&(a[i]=e.target.value),"object"===_typeof(a[i])){var n=u._getValueByValue(a[i],r,o);n=e.target.value,u._setValueByValue(a[i],r,o,n)}}};if(e.oninput=n,e.eventinput=n,e.eventTypes){var c=JSON.parse(e.eventTypes);c.push("input"),e.eventTypes=JSON.stringify(c)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},e.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},e.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},e.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},e.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},e.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},e.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},e.prototype.eventHandler=function(o,i,e,t,a,s){var n=t.split(":")[1],u=this._getVMFunction(i,e),c=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/ /g,"").split(","),p=this,r=function(e){var n=this,r=[];c.forEach(function(t){return""!==t&&("$event"===t?r.push(e):"$element"===t?r.push(o):"true"===t||"false"===t?r.push("true"===t):/(\$\.).*/g.test(t)?r.push(p._getVMVal(i.state,t)):/\'.*\'/g.test(t)?r.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?r.push(Number(t)):0===t.indexOf(a)||0===t.indexOf(a+".")?r.push(p._getVMRepeatVal(s,t,a)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return r.push(p._getValueByValue(n.repeatData[e],t,e))})))}),u.apply(i,r)};if(n&&u){if(o["on"+n]=r,o["event"+n]=r,o.eventTypes){var l=JSON.parse(o.eventTypes);l.push(n),o.eventTypes=JSON.stringify(l)}o.eventTypes||(o.eventTypes=JSON.stringify([n]))}},e}(),h=function(){function f(e){this.$fragment=e}return f.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").replace("$.","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},f.prototype._getVMVal=function(e,t){var n=t.replace("()","").replace("$.","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},f.prototype._getVMRepeatVal=function(e,t){var n=t.split(" ");return this._getVMVal(e.state,n[3])},f.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},f.prototype._getVMFunctionArguments=function(t,e,n){var r=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),o=[];return r.forEach(function(e){return""!==e&&("$element"===e?o.push(n):"true"===e||"false"===e?o.push("true"===e):/(\$\.).*/g.test(e)?o.push((new f)._getVMVal(t.state,e)):/\'.*\'/g.test(e)?o.push(e.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(e)&&/^[0-9]*$/g.test(e)?o.push(Number(e)):void 0)}),o},f.prototype.bind=function(e,t,n,r){var o=this[r+"Updater"];if(this.isRepeatNode(e))switch(r){case"repeat":o&&o.call(this,e,this._getVMRepeatVal(t,n),n,t)}else{var i=null;if(/^(\@)/.test(n)){if("model"===r)throw new Error("directive: nv-model can't use "+n+" as value");var a=this._getVMFunction(t,n),s=this._getVMFunctionArguments(t,n,e);i=a.apply(t,s)}else{if(!/(\$\.).*/.test(n))throw new Error("directive: nv-"+r+" can't use recognize this value "+n);i=this._getVMVal(t.state,n)}switch(r){case"model":o&&o.call(this,e,i,n,t);break;case"text":case"html":case"if":case"class":case"key":o&&o.call(this,e,i);break;default:this.commonUpdater.call(this,e,i,r)}}},f.prototype.templateUpdater=function(e,t,n){var r=n.replace("{{","").replace("}}",""),o=null;if(/^(\@)/.test(r)){var i=this._getVMFunction(t,r),a=this._getVMFunctionArguments(t,r,e);o=i.apply(t,a)}else{if(!/(\$\.).*/.test(r))throw new Error("directive: "+n+" can't use recognize this value");o=this._getVMVal(t.state,r)}e.textContent=e.textContent.replace(n,o)},f.prototype.modelUpdater=function(e,t,n,r){e.value=void 0===t?"":t;var o=n.replace("$.",""),i=function(e){e.preventDefault(),/(\$\.).*/.test(n)&&(r.state[o]=e.target.value)};if(e.oninput=i,e.eventinput=i,e.eventTypes){var a=JSON.parse(e.eventTypes);a.push("input"),e.eventTypes=JSON.stringify(a)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},f.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},f.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},f.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},f.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},f.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},f.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},f.prototype.repeatUpdater=function(r,s,u,c){var p=this;if(s){if(s&&!(s instanceof Array))throw new Error("compile error: nv-repeat need an Array!");var l=u.split(" ")[1];s.forEach(function(o,i){var e={};e[l]=o,e.$index=i;var a=p.cloneNode(r,e),t=a.attributes,n=a.textContent;p.$fragment.insertBefore(a,r),a.removeAttribute("nv-repeat"),p.isTextNode(a)&&/\{\{(.*)\}\}/g.test(n)&&new $(p.$fragment).templateUpdater(a,o,l,c),t&&Array.from(t).forEach(function(e){var t=e.name;if(p.isDirective(t)&&"nv-repeat"!==t){var n=t.substring(3),r=e.value;p.isEventDirective(n)?(new $(p.$fragment).eventHandler(a,c,r,n,l,o),a.removeAttribute(t)):new $(p.$fragment).bind(a,l,n,r,i,c,s,o)}}),a.hasChildNodes()&&p.$fragment.contains(a)&&p.repeatChildrenUpdater(a,o,u,i,c,s)})}},f.prototype.repeatChildrenUpdater=function(a,s,u,c,p,l){var d=this,h=u.split(" ")[1];Array.from(a.childNodes).forEach(function(o){d.isElementNode(o)&&p.$declarations.find(function(e){return e.$selector===o.tagName.toLocaleLowerCase()&&"nvComponent"===e.nvType})&&(o.isComponent=!0),o.repeatData=a.repeatData||{},o.repeatData[h]=s,o.repeatData.$index=c,d.isRepeatProp(o)&&o.setAttribute("_prop-"+h,JSON.stringify(s));var e=o.attributes,t=o.textContent;d.isTextNode(o)&&/\{\{(.*)\}\}/g.test(t)&&new $(a).templateUpdater(o,s,h,p),e&&Array.from(e).forEach(function(e){var t=e.name,n=e.value,r=t.substring(3);d.isDirective(t)&&"nv-repeat"!==t&&new RegExp("(^"+h+")|(^$.)|(^@)").test(n)&&(d.isEventDirective(r)?(new $(a).eventHandler(o,p,n,r,h,s),o.removeAttribute(t)):new $(a).bind(o,h,r,n,c,p,l,s))}),o.hasChildNodes()&&!d.isRepeatNode(o)&&a.contains(o)&&d.repeatChildrenUpdater(o,s,u,c,p,l);var n=o.attributes;if(n&&a.contains(o)){var r=Array.from(n).find(function(e){return d.isDirective(e.name)&&"nv-repeat"===e.name});if(r){var i=r.value.split(" ")[3];/^(\$\.)/.test(i)&&(new f(a).bind(o,p,r.value,r.name.substring(3)),a.contains(o)&&a.removeChild(o)),new RegExp("(^"+h+")").test(i)&&(new f(a).repeatUpdater(o,d._getValueByValue(s,i,h),r.value,p),a.contains(o)&&a.removeChild(o)),a.removeAttribute("nv-repeat")}}})},f.prototype.eventHandler=function(r,o,e,t){var n=t.split(":")[1],i=this._getVMFunction(o,e),a=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),s=function(t){var n=[];a.forEach(function(e){return""!==e&&("$event"===e?n.push(t):"$element"===e?n.push(r):"true"===e||"false"===e?n.push("true"===e):/(\$\.).*/g.test(e)?n.push((new f)._getVMVal(o.state,e)):/\'.*\'/g.test(e)?n.push(e.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(e)&&/^[0-9]*$/g.test(e)?n.push(Number(e)):void 0)}),i.apply(o,n)};if(n&&i){if(r["on"+n]=s,r["event"+n]=s,r.eventTypes){var u=JSON.parse(r.eventTypes);u.push(n),r.eventTypes=JSON.stringify(u)}r.eventTypes||(r.eventTypes=JSON.stringify([n]))}},f.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},f.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},f.prototype.isElementNode=function(e){return 1===e.nodeType},f.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},f.prototype.isRepeatProp=function(e){var t=e.attributes;return!!t&&!!Array.from(t).find(function(e){return/^\{(.+)\}$/.test(e.value)})},f.prototype.isTextNode=function(e){return 3===e.nodeType},f.prototype.cloneNode=function(t,e){var n=t.cloneNode(!0);return t.eventTypes&&(JSON.parse(t.eventTypes).forEach(function(e){n["on"+e]=t["event"+e],n["event"+e]=t["event"+e]}),n.eventTypes=t.eventTypes),e&&(n.repeatData=e),t.isComponent&&(n.isComponent=!0),n},f}();function f(e){var t=[],n=["nv-model","nv-text","nv-html","nv-if","nv-key"];return e.attributes&&Array.from(e.attributes).forEach(function(e){/^nv\-.*/.test(e.name)&&-1===n.indexOf(e.name)&&t.push(e.name.replace("nv-",""))}),t}var v=new i,m=function(){function e(e,t){if(this.$vm=t,this.$el=this.isElementNode(e)?e:document.querySelector(e),this.$el){this.$fragment=this.node2Fragment(),this.init();var n=l(this.$el,f),r=l(this.$fragment,f),o=[];d(n,r,o,this.needDiffChildCallback.bind(this)),(i=o).sort(function(e,t){return e.type===t.type&&e.newIndex&&t.newIndex?e.newIndex-t.newIndex:e.type-t.type}),i.forEach(function(e){switch(e.type){case 0:e.parentNode.removeChild(e.node);break;case 1:Array.from(e.parentNode.children).indexOf(e.oldVnode)!==e.newIndex&&(e.parentNode.contains(e.oldVnode)&&e.parentNode.removeChild(e.oldVnode),e.parentNode.childNodes[e.newIndex]?e.parentNode.insertBefore(e.oldVnode,e.parentNode.childNodes[e.newIndex]):e.parentNode.appendChild(e.oldVnode));break;case 2:e.node.setAttribute(e.newValue.name,e.newValue.value);break;case 3:e.node.removeAttribute(e.oldValue.name);break;case 4:e.node.nodeValue=e.newValue;break;case 5:e.node.value=e.newValue;break;case 6:e.node.repeatData=e.newValue;break;case 7:e.node["on"+e.eventType]=e.newValue;break;case 8:e.node.eventTypes=e.newValue}}),o=r=n=this.$fragment=null}var i}return e.prototype.needDiffChildCallback=function(e,t){return t.node.isComponent&&e.node?!(e.node.isComponent=!0):e.tagName!==t.tagName||t.tagName!==this.$vm.$vm.getRouteDOMKey().toLocaleUpperCase()},e.prototype.init=function(){this.compileElement(this.$fragment)},e.prototype.compileElement=function(e){var t=document.createElement("div");t.innerHTML=v.formatInnerHTML(this.$vm.$template);var n=t.childNodes;this.recursiveDOM(n,e)},e.prototype.recursiveDOM=function(e,i){var a=this;Array.from(e).forEach(function(t){a.isElementNode(t)&&a.$vm.$declarations.find(function(e){return e.$selector===t.tagName.toLocaleLowerCase()&&"nvComponent"===e.nvType})&&(t.isComponent=!0),t.hasChildNodes()&&!a.isRepeatNode(t)&&a.recursiveDOM(t.childNodes,t),i.appendChild(t);var e=t.textContent;if(a.isElementNode(t)&&a.compile(t,i),a.isTextNode(t)&&/\{\{(.*)\}\}/g.test(e)){var n=e.match(/(\{\{[^\{\}]+?\}\})/g),r=n.length;if(n&&0<r)for(var o=0;o<r;o++)a.compileText(t,n[o])}a.isRepeatNode(t)&&i.contains(t)&&i.removeChild(t)})},e.prototype.compile=function(i,a){var s=this,e=i.attributes;e&&Array.from(e).forEach(function(e){var t=e.name;if(s.isDirective(t)){var n=t.substring(3),r=e.value,o=new h(a);s.isEventDirective(n)?(o.eventHandler(i,s.$vm,r,n),i.removeAttribute(t)):o.bind(i,s.$vm,r,n)}})},e.prototype.node2Fragment=function(){return document.createDocumentFragment()},e.prototype.compileText=function(e,t){new h(this.$fragment).templateUpdater(e,this.$vm,t)},e.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},e.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},e.prototype.isElementNode=function(e){return"string"!=typeof e&&1===e.nodeType},e.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},e.prototype.isTextNode=function(e){return 3===e.nodeType},e}(),y=function(e,t){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function g(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(a=(i<3?o(a):3<i?o(t,n,a):o(t,n))||a);return 3<i&&a&&Object.defineProperty(t,n,a),a}function w(i,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}o((u=u.apply(i,a||[])).next())})}function R(n,r){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function M(t){var e=Reflect.getMetadata("design:paramtypes",t);e&&e.length&&e.forEach(function(e){if(e===t)throw new Error("不可以依赖自身");t._needInjectedClass?t._needInjectedClass.push(e):t._needInjectedClass=[e]})}function C(t){return function(e){M(e),e.isSingletonMode=!0,t&&(e.isSingletonMode=t.isSingletonMode)}}function E(s,u,c,p){var l=[],e=[];return s._needInjectedClass&&(e=s._needInjectedClass),s.injectTokens&&(e=s.injectTokens),0===e.length||e.forEach(function(e){if(p&&p.has(e))return l.push(p.get(e));if(s.prototype.$providerList){var t=s.prototype.$providerList.get(e);if(t&&!t.useClass&&!t.useValue)return l.push(_(t,u,c,p));if(t&&t.useClass)return l.push(_(t.useClass,u,c,p));if(t&&t.useValue)return l.push(t.useValue)}var n=null,r=null;if(c&&c.$providerList.has(e))n=c.$providerList.get(e),r=c;else{if(!u||!u.$providerList.has(e))throw new Error("injector injects service error: can't find provide: "+e.name+" in Component "+s);n=u.$providerList.get(e),r=u}var o=null;if(!n||n.useClass||n.useValue||(o=n),n&&n.useClass&&(o=n.useClass),n&&n.useValue)return l.push(n.useValue);if(!o)throw new Error("injector injects service error: can't find provide: "+e.name+" in Component "+s);if(o&&!o.isSingletonMode&&l.push(_(o,u,r,p)),o&&o.isSingletonMode){var i=r.$providerInstances.has(e)?r.$providerInstances.get(e):null;if(i&&l.push(i),!i){var a=_(o,u,r,p);r.$providerInstances.set(e,a),l.push(a)}}}),l}function _(e,t,n,r){var o=E(e,t,n,r);return Reflect.construct(e,o)}var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(HTMLElement),D=new i,x=function(){function a(){this.modalList=[],D.isBrowser()&&(this.rootDom=document.querySelector("#root"),this.$rootPath="/",this.$canRenderModule=!0,this.$routeDOMKey="router-render",this.$rootModule=null,this.render=F,this.reRender=F)}return a.prototype.use=function(e){return e.bootstrap(this),this.modalList.push(e),this.modalList.length-1},a.prototype.setRootPath=function(e){if(!e||"string"!=typeof e)throw new Error("rootPath is not defined or rootPath must be a String");this.$rootPath=e},a.prototype.getRootPath=function(){return this.$rootPath},a.prototype.setComponentRender=function(e,t){this.render=e,this.reRender=t||e},a.prototype.getComponentRender=function(){return{render:this.render,reRender:this.reRender}},a.prototype.setCanRenderModule=function(e){this.$canRenderModule=e},a.prototype.getCanRenderModule=function(){return this.$canRenderModule},a.prototype.setRouteDOMKey=function(e){this.$routeDOMKey=e},a.prototype.getRouteDOMKey=function(){return this.$routeDOMKey},a.prototype.getRootModule=function(){return this.$rootModule},a.prototype.getDirectives=function(){return this.$declarations},a.prototype.bootstrapModule=function(e){if(!e)throw new Error("must send a root module");this.$rootModule=V(e,this),this.$declarations=this.$rootModule.$declarations.slice()},a.prototype.init=function(){if(D.isBrowser()){if(!this.$rootModule)throw new Error("must use bootstrapModule to declare a root NvModule before init");this.$canRenderModule&&this.renderModuleBootstrap()}},a.prototype.renderModuleBootstrap=function(){if(!this.$rootModule.$bootstrap)throw new Error("need bootstrap for render Module Bootstrap");var e=this.$rootModule.$bootstrap;this.renderComponent(e,this.rootDom)},a.prototype.renderComponent=function(e,t,n){var r=new Map;r.set(a,this),r.set(O,t);var o=_(e,this.$rootModule,n,r);if(o.$vm=this,o.$declarations=n?n.$declarations:this.$rootModule.$declarations,o.render=this.render.bind(o),o.reRender=this.reRender.bind(o),o.nvOnInit&&o.nvOnInit(),o.watchData&&o.watchData(),!o.$template)throw new Error("must decaler this.$template in bootstrap()");var i=o.$template;if(i&&"string"==typeof i&&t)return o.nvBeforeMount&&o.nvBeforeMount(),this.replaceDom(o,t).then(function(e){return e.nvAfterMount&&e.nvAfterMount(),e});throw new Error("renderBootstrap failed: template or rootDom is not exit")},a.prototype.replaceDom=function(e,t){return e.renderDom=t,e.render()},a}();function V(e,t){var n=new Map;return t&&n.set(x,t),function(e){if(e.$providers)for(var t=e.$providers.length,n=0;n<t;n++){var r=e.$providers[n];r.provide?(r.useClass||r.useValue)&&e.$providerList.set(r.provide,r):e.$providerList.set(r,r)}}(e.prototype),function(n){if(n.$declarations)for(var e=n.$declarations.length,t=function(e){var t=n.$declarations[e];t._injectedDeclarations||(t._injectedDeclarations=new Map),n.$declarations.forEach(function(e){t._injectedDeclarations.has(e.$selector)||t._injectedDeclarations.set(e.$selector,e)})},r=0;r<e;r++)t(r)}(e.prototype),function(n,e){if(n.$imports)for(var t=n.$imports.length,r=0;r<t;r++){var o=V(n.$imports[r],e);if(o.$exportsList)for(var i=o.$exportsList.length,a=function(e){var t=o.$exportsList[e];n.$declarations.find(function(e){return e.$selector===t.$selector})||n.$declarations.push(t)},s=0;s<i;s++)a(s);o.$providerList&&o.$providerList.forEach(function(e,t){n.$providerList.has(t)||n.$providerList.set(t,e)})}}(e.prototype,t),function(a,s){if(a.$exports)for(var e=a.$exports.length,t=function(e){var t=a.$exports[e];if("nvModule"===t.nvType)for(var n=V(t,s),r=n.$exportsList.length,o=function(e){var t=n.$exportsList[e];a.$exportsList.find(function(e){return e.$selector===t.$selector})||a.$exportsList.push(t)},i=0;i<r;i++)o(i);"nvModule"!==t.nvType&&(a.$exportsList.find(function(e){return e.$selector===t.$selector})||a.$exportsList.push(t))},n=0;n<e;n++)t(n)}(e.prototype,t),_(e,e.prototype,null,n)}function N(n){return function(e){M(e),e.nvType="nvModule";var t=e.prototype;t.$providerList=new Map,t.$providerInstances=new Map,n.imports&&(t.$imports=n.imports),n.declarations&&(t.$declarations=n.declarations),n.providers&&(t.$providers=n.providers),n.exports&&(t.$exports=n.exports,t.$exportsList=[]),n.bootstrap&&(t.$bootstrap=n.bootstrap)}}var L=new i,j=function(){function a(){this.modalList=[],L.isBrowser()&&(this.rootDom=document.querySelector("#root"),this.$rootPath="/",this.$canRenderModule=!0,this.$routeDOMKey="router-render",this.$rootModule=null,this.render=F,this.reRender=F)}return a.prototype.use=function(e){return e.bootstrap(this),this.modalList.push(e),this.modalList.length-1},a.prototype.setRootPath=function(e){if(!e||"string"!=typeof e)throw new Error("rootPath is not defined or rootPath must be a String");this.$rootPath=e},a.prototype.getRootPath=function(){return this.$rootPath},a.prototype.setComponentRender=function(e,t){this.render=e,this.reRender=t||e},a.prototype.getComponentRender=function(){return{render:this.render,reRender:this.reRender}},a.prototype.setCanRenderModule=function(e){this.$canRenderModule=e},a.prototype.getCanRenderModule=function(){return this.$canRenderModule},a.prototype.setRouteDOMKey=function(e){this.$routeDOMKey=e},a.prototype.getRouteDOMKey=function(){return this.$routeDOMKey},a.prototype.getRootModule=function(){return this.$rootModule},a.prototype.getDirectives=function(){return this.$declarations},a.prototype.bootstrapModule=function(e){if(!e)throw new Error("must send a root module");this.$rootModule=V(e,this),this.$declarations=this.$rootModule.$declarations.slice()},a.prototype.init=function(){if(L.isBrowser()){if(!this.$rootModule)throw new Error("must use bootstrapModule to declare a root NvModule before init");this.$canRenderModule&&this.renderModuleBootstrap()}},a.prototype.renderModuleBootstrap=function(){if(!this.$rootModule.$bootstrap)throw new Error("need bootstrap for render Module Bootstrap");var e=this.$rootModule.$bootstrap;this.renderComponent(e,this.rootDom)},a.prototype.renderComponent=function(e,t,n){var r=new Map;r.set(a,this),r.set(O,t);var o=_(e,this.$rootModule,n,r);if(o.$vm=this,o.$declarations=n?n.$declarations:this.$rootModule.$declarations,o.render=this.render.bind(o),o.reRender=this.reRender.bind(o),o.nvOnInit&&o.nvOnInit(),o.watchData&&o.watchData(),!o.$template)throw new Error("must decaler this.$template in bootstrap()");var i=o.$template;if(i&&"string"==typeof i&&t)return o.nvBeforeMount&&o.nvBeforeMount(),this.replaceDom(o,t).then(function(e){return e.nvAfterMount&&e.nvAfterMount(),e});throw new Error("renderBootstrap failed: template or rootDom is not exit")},a.prototype.replaceDom=function(e,t){return e.renderDom=t,e.render()},a}(),T=new i;function S(e,t){return T.isFunction(e)?e.bind(t):e}var P=new i;function k(e,o){var i=o.$directiveList.slice();!function(t,d){d.$directiveList=[];var h=t.querySelectorAll(d.$vm.getRouteDOMKey())[0];d.constructor._injectedDeclarations.forEach(function(e,t){d.$declarations.find(function(e){return e.$selector===t})||d.$declarations.push(e)});for(var e=d.$declarations.length,n=function(p){if("nvDirective"!==d.$declarations[p].nvType)return"continue";var l=d.$declarations[p].$selector,e=t.querySelectorAll("*["+l+"]");Array.from(e).forEach(function(n){if(!h||!h.contains(n)){var e=n.getAttribute(l),t=null;if(e){var r=e.split("."),o=r[0];if(/^(\$.).*/g.test(e)&&(t=d.compileUtil._getVMVal(d.state,e)),/^(\@.).*\(.*\)$/g.test(e)){var i=new $,a=i._getVMFunction(d,e),s=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),u=[];s.forEach(function(t){return""!==t&&("$element"===t?u.push(n):"true"===t||"false"===t?u.push("true"===t):/(\$\.).*/g.test(t)?u.push(i._getVMVal(d.state,t)):/\'.*\'/g.test(t)?u.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?u.push(Number(t)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return u.push(i._getValueByValue(n.repeatData[e],t,e))})))});var c=a.apply(d,u);t=c}/^(\@.).*[^\(.*\)]$/g.test(e)&&(t=d.compileUtil._getVMVal(d,e.replace(/^(\@)/,""))),n.repeatData&&null!==n.repeatData[o]&&(t=d.compileUtil._getValueByValue(n.repeatData[o],e,o)),d.$directiveList.push({dom:n,props:t,scope:null,constructorFunction:d.$declarations[p]})}}})},r=0;r<e;r++)n(r)}(e,o);for(var t=o.$directiveList.length,n=function(e){var t=o.$directiveList[e],n=i.findIndex(function(e){return e.dom===t.dom}),r=i[n];-1!==n&&i.splice(n,1),r?(t.scope=r.scope,P.isEqual(t.scope.props,t.props)||(t.scope.nvReceiveProps&&t.scope.nvReceiveProps(t.props),t.scope.props=t.props)):t.scope=function(e,t,n,r){var o=new Map;r.$vm&&o.set(j,r.$vm),o.set(O,n);var i=_(e,r.$vm.$rootModule,null,o);return i.props=t,i.renderDom=n,i.$declarations=r.$declarations,i}(t.constructorFunction,t.props,t.dom,o),t.scope.$vm=o.$vm,t.scope.$declarations=o.$declarations,t.scope.nvOnInit&&!r&&t.scope.nvOnInit(),t.scope.nvBeforeMount&&t.scope.nvBeforeMount()},r=0;r<t;r++)n(r);var a=i.length;for(r=0;r<a;r++){var s=i[r];s.scope.nvOnDestory&&s.scope.nvOnDestory()}}var U=new i;function A(e,o){var i=o.$componentList.slice();!function(r,g){g.$componentList=[];var o=r.querySelectorAll(g.$vm.getRouteDOMKey())[0];g.constructor._injectedDeclarations.forEach(function(e,t){g.$declarations.find(function(e){return e.$selector===t})||g.$declarations.push(e)});for(var e=g.$declarations.length,t=function(n){if("nvComponent"!==g.$declarations[n].nvType)return"continue";var e=g.$declarations[n].$selector,t=r.getElementsByTagName(e);Array.from(t).forEach(function(v){if((!o||!o.contains(v))&&v.isComponent){var e=v.attributes,m={};if(e){var t=Array.from(e),y={};t.forEach(function(e){/^\_prop\-(.+)/.test(e.name)&&(y[e.name.replace("_prop-","")]=JSON.parse(e.value),v.removeAttribute(e.name))}),t.forEach(function(e){var n=e.name;if(!/^\_prop\-(.+)/.test(n)){var t=n.split("-");1<t.length&&t.forEach(function(e,t){0===t&&(n=e),0!==t&&(n+=e.toLowerCase().replace(/( |^)[a-z]/g,function(e){return e.toUpperCase()}))});var r,o,i,a=/^\{(.+)\}$/.exec(e.value);if(a){var s=a[1].split("."),u=s[0],c=null;if(/^(\$.).*/g.test(a[1]))return c=g.compileUtil._getVMVal(g.state,a[1]),void(m[n]=S(c,g));if(/^(\@.).*\(.*\)$/g.test(a[1])){var p=new $,l=p._getVMFunction(g,a[1]),d=a[1].replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),h=[];d.forEach(function(t){return""!==t&&("$element"===t?h.push(v):"true"===t||"false"===t?h.push("true"===t):/(\$\.).*/g.test(t)?h.push(p._getVMVal(g.state,t)):/\'.*\'/g.test(t)?h.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?h.push(Number(t)):void(v.repeatData&&Object.keys(v.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return h.push(p._getValueByValue(v.repeatData[e],t,e))})))});var f=l.apply(g,h);return void(m[n]=f)}if(/^(\@.).*[^\(.*\)]$/g.test(a[1]))return c=g.compileUtil._getVMVal(g,a[1].replace(/^(\@)/,"")),void(m[n]=S(c,g));if(y.hasOwnProperty(u))return r=s,o=y[u],i=o,r.forEach(function(e,t){0!==t&&(i=i[e])}),c=i,void(m[n]=S(c,g));if(v.repeatData&&null!==v.repeatData[u])return c=g.compileUtil._getValueByValue(v.repeatData[u],a[1],u),void(m[n]=S(c,g))}"indiv_repeat_key"!==e.name&&v.removeAttribute(n)}})}g.$componentList.push({dom:v,props:m,scope:null,constructorFunction:g.$declarations[n],hasRender:!1}),v.isComponent=!1}})},n=0;n<e;n++)t(n)}(e,o);for(var t=o.$componentList.length,n=function(e){var t=o.$componentList[e],n=i.findIndex(function(e){return e.dom===t.dom}),r=i[n];-1!==n&&i.splice(n,1),r?(t.scope=r.scope,U.isEqual(t.scope.props,t.props)||(t.scope.nvReceiveProps&&t.scope.nvReceiveProps(t.props),t.scope.props=t.props),t.hasRender=!0):t.scope=function(e,t,n,r){var o=new Map;o&&o.set(j,r.$vm),o.set(O,n);var i=_(e,r.$vm.$rootModule,null,o);return i.props=t,i.renderDom=n,i.$declarations=r.$declarations,i.render=r.$vm.render.bind(i),i.reRender=r.$vm.reRender.bind(i),i}(t.constructorFunction,t.props,t.dom,o),t.scope.$vm=o.$vm,t.scope.$declarations=o.$declarations,t.scope.nvOnInit&&!r&&t.scope.nvOnInit(),t.scope.watchData&&t.scope.watchData(),t.scope.nvBeforeMount&&t.scope.nvBeforeMount()},r=0;r<t;r++)n(r);var a=i.length;for(r=0;r<a;r++){var s=i[r];s.scope.nvOnDestory&&s.scope.nvOnDestory()}}function I(o,i){return w(this,void 0,void 0,function(){var t=this;return R(this,function(e){return[2,Promise.resolve().then(function(){return w(t,void 0,void 0,function(){var t,n,r;return R(this,function(e){switch(e.label){case 0:return new m(o,i.$vm),[4,function(r,o){return w(this,void 0,void 0,function(){return R(this,function(e){return[2,Promise.resolve().then(function(){k(r,o.$vm);for(var e=o.$vm.$directiveList.length,t=0;t<e;t++){var n=o.$vm.$directiveList[t];n.scope.nvAfterMount&&n.scope.nvAfterMount(),n.scope.nvHasRender&&n.scope.nvHasRender()}return o.$vm}).catch(function(e){throw new Error("directive "+o.$vm.constructor.$selector+" render failed: "+e)})]})})}(o,i)];case 1:for(e.sent(),A(o,i.$vm),t=i.$vm.$componentList.length,n=0;n<t;n++)(r=i.$vm.$componentList[n]).hasRender?r.scope.reRender():(r.scope.render(),r.hasRender=!0),r.scope.nvAfterMount&&r.scope.nvAfterMount();return i.$vm.nvHasRender&&i.$vm.nvHasRender(),[2,i.$vm]}})})}).catch(function(e){throw new Error("component "+i.$vm.constructor.$selector+" render failed: "+e)})]})})}var q="pending",B=function(){function e(e){this.$vm=e,this.resetStatus()}return e.prototype.push=function(e){if(this.taskQueue.push(e),this.renderStatus===q)return this.renderStatus="rendering",this.runTask()},e.prototype.stopTask=function(){this.renderStatus=q},e.prototype.runTask=function(){return w(this,void 0,void 0,function(){var t;return R(this,function(e){switch(e.label){case 0:return[4,I(this.taskQueue[this.queuePointer],this)];case 1:return t=e.sent(),this.nextTask(),[2,t]}})})},e.prototype.nextTask=function(){return w(this,void 0,void 0,function(){return R(this,function(e){return this.taskQueue.length!==this.queuePointer+1?(this.queuePointer++,this.renderStatus===q?[2]:[2,this.runTask()]):(this.resetStatus(),[2])})})},e.prototype.resetStatus=function(){this.renderStatus=q,this.queuePointer=0,this.taskQueue?this.taskQueue.length=0:this.taskQueue=[]},e}();function F(){this.compileUtil=new h;var e=this.renderDom;return this.renderTaskQueue||(this.renderTaskQueue=new B(this)),this.renderTaskQueue.push(e)}var J=new i,W=function(){function e(){}return e.prototype.getLocation=function(){return J.isBrowser()?{path:K.nvRouteObject.path,query:K.nvRouteObject.query,params:K.nvRouteParmasObject,data:K.nvRouteObject.data,rootPath:K.nvRootPath}:{}},e.prototype.setLocation=function(e,t,n,r){if(J.isBrowser()){var o="/"===K.nvRootPath?"":K.nvRootPath;history.pushState({path:e,query:t,data:n},r,""+o+e+J.buildQuery(t)),K.nvRouteObject={path:e,query:t,data:n}}},e=g([C()],e)}(),H=new i,K={nvRouteObject:{path:null,query:{},data:null},nvRouteParmasObject:{},nvRootPath:"/"},Q=function(){function e(e){this.indivInstance=e,this.routesList=[],this.currentUrl="",this.lastRoute=null,this.hasRenderComponentList=[],this.needRedirectPath=null,this.watcher=null,this.renderRouteList=[],this.loadModuleMap=new Map,this.routes||(this.routes=[]),K.nvRootPath||(K.nvRootPath="/"),this.indivInstance.setRootPath(K.nvRootPath),this.indivInstance.setCanRenderModule(!1),this.indivInstance.setRouteDOMKey("router-render"),H.isBrowser()&&(window.addEventListener("load",this.refresh.bind(this),!1),window.addEventListener("popstate",function(){var e;e="/"===K.nvRootPath?location.pathname||"/":""===location.pathname.replace(K.nvRootPath,"")?"/":location.pathname.replace(K.nvRootPath,""),K.nvRouteObject={path:e,query:{},data:null},K.nvRouteParmasObject={}},!1))}var t;return(t=e).forRoot=function(e){if(e.rootPath&&(K.nvRootPath=e.rootPath),e.routeChange&&(t.prototype.routeChange=e.routeChange),!(e.routes&&e.routes instanceof Array))throw new Error("route error: no routes exit");if(t.prototype.routes=e.routes,H.isBrowser())return t},e.prototype.redirectTo=function(e){var t="/"===K.nvRootPath?"":K.nvRootPath;history.replaceState(null,null,""+t+e),K.nvRouteObject={path:e||"/",query:{},data:null},K.nvRouteParmasObject={}},e.prototype.refresh=function(){if(!K.nvRouteObject||!this.watcher){var e=void 0;e="/"===K.nvRootPath?location.pathname||"/":""===location.pathname.replace(K.nvRootPath,"")?"/":location.pathname.replace(K.nvRootPath,""),K.nvRouteObject={path:e,query:{},data:null},K.nvRouteParmasObject={},this.watcher=new c(K,"nvRouteObject",this.refresh.bind(this))}this.currentUrl=K.nvRouteObject.path||"/",this.routesList=[],this.renderRouteList="/"===this.currentUrl?["/"]:this.currentUrl.split("/"),this.renderRouteList[0]="/",this.distributeRoutes()},e.prototype.distributeRoutes=function(){return w(this,void 0,void 0,function(){return R(this,function(e){switch(e.label){case 0:return this.lastRoute&&this.lastRoute!==this.currentUrl?(K.nvRouteParmasObject={},[4,this.insertRenderRoutes()]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.generalDistributeRoutes()];case 3:e.sent(),e.label=4;case 4:return this.routeChange&&this.routeChange(this.lastRoute,this.currentUrl),this.lastRoute=this.currentUrl,this.needRedirectPath&&(this.redirectTo(this.needRedirectPath),this.needRedirectPath=null),[2]}})})},e.prototype.insertRenderRoutes=function(){return w(this,void 0,void 0,function(){var f,t,v,n,r;return R(this,function(e){switch(e.label){case 0:(f="/"===this.lastRoute?["/"]:this.lastRoute.split("/"))[0]="/",t=function(t){var n,r,o,i,a,s,u,c,p,l,d,h;return R(this,function(e){switch(e.label){case 0:if(n=v.renderRouteList[t],0===t){if(!(r=v.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+v.currentUrl);v.routesList.push(r)}else{if(!((o=v.routesList[t-1].children)&&o instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(i=o.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+v.currentUrl);v.routesList.push(i)}if(n===f[t])return[3,6];if(!(h=v.routesList[t]))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+v.currentUrl);if(d=document.querySelectorAll("router-render")[t-1],!h.component&&!h.redirectTo&&!h.loadChild)throw new Error("route error: path "+h.path+" need a component which has children path or need a redirectTo which has't children path");return/^\/\:.+/.test(h.path)&&!h.redirectTo&&(l=h.path.split("/:")[1],K.nvRouteParmasObject[l]=n),s=a=null,u="",v.routesList.forEach(function(e,t){0!==t&&(u+=e.path)}),h.component?(c=v.findComponentFromModule(h.component,u),a=c.component,[4,v.instantiateComponent(a,d,c.loadModule)]):[3,2];case 1:s=e.sent(),e.label=2;case 2:return h.loadChild?[4,v.NvModuleFactoryLoader(h.loadChild)]:[3,5];case 3:return p=e.sent(),v.loadModuleMap.set(u,p),a=p.$bootstrap,[4,v.instantiateComponent(a,d,p)];case 4:s=e.sent(),e.label=5;case 5:if(a){if(!s)throw new Error("route error: path "+h.path+" need a component");v.hasRenderComponentList[t]&&v.hasRenderComponentList.splice(t,0,s),v.hasRenderComponentList[t]||(v.hasRenderComponentList[t]=s),v.routerChangeEvent(t)}if(h.redirectTo&&/^\/.*/.test(h.redirectTo)&&t+1===v.renderRouteList.length)return v.needRedirectPath=h.redirectTo,[2,{value:void 0}];e.label=6;case 6:return n===f[t]&&(h=v.routesList[t],/^\/\:.+/.test(h.path)&&!h.redirectTo&&(l=h.path.split("/:")[1],K.nvRouteParmasObject[l]=n)),t===v.renderRouteList.length-1&&t<f.length-1&&(d=document.querySelectorAll("router-render")[t],v.routerChangeEvent(t),d&&d.hasChildNodes()&&d.removeChild(d.childNodes[0]),(h=v.routesList[t]).redirectTo&&/^\/.*/.test(h.redirectTo)&&t+1===v.renderRouteList.length)?(v.needRedirectPath=h.redirectTo,[2,{value:void 0}]):[2]}})},v=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.generalDistributeRoutes=function(){return w(this,void 0,void 0,function(){var t,v,n,r;return R(this,function(e){switch(e.label){case 0:t=function(t){var n,r,o,i,a,s,u,c,p,l,d,h,f;return R(this,function(e){switch(e.label){case 0:if(n=v.renderRouteList[t],0!==t)return[3,6];if(!(r=v.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in generalDistributeRoutes: "+v.currentUrl);return o=document.querySelector("#root"),p=c=null,i="",v.routesList.forEach(function(e,t){0!==t&&(i+=e.path)}),i+=r.path,r.component?(d=v.findComponentFromModule(r.component,i),c=d.component,[4,v.instantiateComponent(c,o,d.loadModule)]):[3,2];case 1:p=e.sent(),e.label=2;case 2:return r.loadChild?[4,v.NvModuleFactoryLoader(r.loadChild)]:[3,5];case 3:return h=e.sent(),v.loadModuleMap.set(i,h),c=h.$bootstrap,[4,v.instantiateComponent(c,o,h)];case 4:p=e.sent(),e.label=5;case 5:if(!c)throw new Error("route error: root route's path: "+r.path+" need a component");return/^\/\:.+/.test(r.path)&&(f=r.path.split("/:")[1],K.nvRouteParmasObject[f]=n),H.isBrowser()?(v.routesList.push(r),p&&v.hasRenderComponentList.push(p),t===v.renderRouteList.length-1&&v.routerChangeEvent(t),r.redirectTo&&/^\/.*/.test(r.redirectTo)&&t+1===v.renderRouteList.length?(v.needRedirectPath=r.redirectTo,v.renderRouteList.push(r.redirectTo),[2,{value:void 0}]):[3,12]):[2,{value:void 0}];case 6:if(!((a=v.routesList[t-1].children)&&a instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(s=a.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+v.currentUrl);return u=document.querySelectorAll("router-render")[t-1],p=c=null,l="",v.routesList.forEach(function(e,t){0!==t&&(l+=e.path)}),l+=s.path,s.component?(d=v.findComponentFromModule(s.component,l),c=d.component,[4,v.instantiateComponent(c,u,d.loadModule)]):[3,8];case 7:p=e.sent(),e.label=8;case 8:return s.loadChild?[4,v.NvModuleFactoryLoader(s.loadChild)]:[3,11];case 9:return h=e.sent(),v.loadModuleMap.set(l,h),c=h.$bootstrap,[4,v.instantiateComponent(c,u,h)];case 10:p=e.sent(),e.label=11;case 11:if(!s.component&&!s.redirectTo&&!s.loadChild)throw new Error("route error: path "+s.path+" need a component which has children path or need a  redirectTo which has't children path");if(/^\/\:.+/.test(s.path)&&(f=s.path.split("/:")[1],K.nvRouteParmasObject[f]=n),v.routesList.push(s),p&&v.hasRenderComponentList.push(p),t===v.renderRouteList.length-1&&v.routerChangeEvent(t),s.redirectTo&&/^\/.*/.test(s.redirectTo)&&t+1===v.renderRouteList.length)return v.needRedirectPath=s.redirectTo,[2,{value:void 0}];e.label=12;case 12:return[2]}})},v=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.routerChangeEvent=function(n){var r=this;this.hasRenderComponentList.forEach(function(e,t){e.nvRouteChange&&e.nvRouteChange(r.lastRoute,r.currentUrl),r.emitDirectiveEvent(e.$directiveList,"nvRouteChange"),r.emitComponentEvent(e.$componentList,"nvRouteChange"),n+1<=t&&(e.nvOnDestory&&e.nvOnDestory(),r.emitDirectiveEvent(e.$directiveList,"nvOnDestory"),r.emitComponentEvent(e.$componentList,"nvOnDestory"))}),this.hasRenderComponentList.length=n+1},e.prototype.emitComponentEvent=function(e,t){var n=this;"nvRouteChange"===t&&e.forEach(function(e){e.scope.nvRouteChange&&e.scope.nvRouteChange(n.lastRoute,n.currentUrl),n.emitDirectiveEvent(e.scope.$directiveList,t),n.emitComponentEvent(e.scope.$componentList,t)}),"nvOnDestory"===t&&e.forEach(function(e){e.scope.nvOnDestory&&e.scope.nvOnDestory(),n.emitDirectiveEvent(e.scope.$directiveList,t),n.emitComponentEvent(e.scope.$componentList,t)})},e.prototype.emitDirectiveEvent=function(e,t){var n=this;"nvRouteChange"===t&&e.forEach(function(e){e.scope.nvRouteChange&&e.scope.nvRouteChange(n.lastRoute,n.currentUrl)}),"nvOnDestory"===t&&e.forEach(function(e){e.scope.nvOnDestory&&e.scope.nvOnDestory()})},e.prototype.instantiateComponent=function(e,t,n){return this.indivInstance.renderComponent(e,t,n)},e.prototype.NvModuleFactoryLoader=function(n){return w(this,void 0,void 0,function(){var t;return R(this,function(e){switch(e.label){case 0:return t=null,n instanceof Function&&!n.child?[4,n()]:[3,2];case 1:t=e.sent().default,e.label=2;case 2:return n instanceof Object&&n.child?[4,n.child()]:[3,4];case 3:t=e.sent()[n.name],e.label=4;case 4:if(!t)throw new Error("load child failed, please check your routes.");return[2,V(t,this.indivInstance)]}})})},e.prototype.findComponentFromModule=function(n,r){if(0===this.loadModuleMap.size)return{component:this.indivInstance.getDirectives().find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),loadModule:null};var o=null,i=null;return this.loadModuleMap.forEach(function(e,t){new RegExp("^"+t+".*").test(r)&&(o=e.$declarations.find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),i=e)}),o||(o=this.indivInstance.getDirectives().find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),i=null),{component:o,loadModule:i}},e=t=g([N({providers:[{useClass:W,provide:W}]}),function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[x])],e)}(),z=new i;new i;var G=function(){function e(){}return e.prototype.createRequest=function(e,t){var n=Object.assign({url:e},t);return o.create(n)},e.prototype.request=function(e,t){var n=Object.assign({url:e},t);return rxjs.from(o.request(n))},e.prototype.get=function(e,t){return rxjs.from(o.get(e,t))},e.prototype.delete=function(e,t){return rxjs.from(o.delete(e,t))},e.prototype.head=function(e,t){return rxjs.from(o.head(e,t))},e.prototype.post=function(e,t){return rxjs.from(o.post(e,t))},e.prototype.put=function(e,t){return rxjs.from(o.put(e,t))},e.prototype.patch=function(e,t){return rxjs.from(o.patch(e,t))},e.prototype.createRequestInterceptor=function(e,t){return o.interceptors.request.use(e,t)},e.prototype.removeRequestInterceptor=function(e){o.interceptors.request.eject(e)},e.prototype.createResponseInterceptor=function(e,t){return o.interceptors.response.use(e,t)},e.prototype.removeResponseInterceptor=function(e){o.interceptors.response.eject(e)},e=g([C()],e)}();t.Utils=i,t.Watcher=s,t.KeyWatcher=c,t.Compile=m,t.CompileUtil=h,t.CompileUtilForRepeat=$,t.RouteModule=Q,t.NvLocation=W,t.Component=function(i){return function(e){M(e),e.nvType="nvComponent",e.$selector=i.selector,e._injectedDeclarations=new Map;var t=e.prototype;if(t.$template=i.template,i.providers&&0<i.providers.length){t.$providerList=new Map;for(var n=i.providers.length,r=0;r<n;r++){var o=i.providers[r];o.provide?(o.useClass||o.useValue)&&t.$providerList.set(o.provide,o):t.$providerList.set(o,o)}}t.$declarations=[],t.$componentList=[],t.$directiveList=[],t.watchData=function(){this.state&&(this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))))}}},t.setState=function(e){if(e&&z.isFunction(e)){var t=e();if(t&&t instanceof Object){if(z.isEqual(this.state,t))return;var n=JSON.parse(JSON.stringify(this.state));Object.assign(n,t),this.state=n,this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))),this.reRender()}}if(e&&e instanceof Object){if(z.isEqual(this.state,e))return;n=JSON.parse(JSON.stringify(this.state)),Object.assign(n,e),this.state=n,this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))),this.reRender()}},t.Directive=function(i){return function(e){M(e),e.nvType="nvDirective",e.$selector=i.selector,e._injectedDeclarations=new Map;var t=e.prototype;if(i.providers&&0<i.providers.length){t.$providerList=new Map;for(var n=i.providers.length,r=0;r<n;r++){var o=i.providers[r];o.provide?(o.useClass||o.useValue)&&t.$providerList.set(o.provide,o):t.$providerList.set(o,o)}}t.$declarations=[]}},t.InDiv=x,t.NvModule=N,t.factoryModule=V,t.HttpClient=G,t.Injectable=C,t.injector=E,t.factoryCreator=_,t.ElementRef=O}),bundle$1=unwrapExports(bundle),bundle_1=bundle.Utils,bundle_2=bundle.Watcher,bundle_3=bundle.KeyWatcher,bundle_4=bundle.Compile,bundle_5=bundle.CompileUtil,bundle_6=bundle.CompileUtilForRepeat,bundle_7=bundle.RouteModule,bundle_8=bundle.NvLocation,bundle_9=bundle.Component,bundle_10=bundle.setState,bundle_11=bundle.Directive,bundle_12=bundle.InDiv,bundle_13=bundle.NvModule,bundle_14=bundle.factoryModule,bundle_15=bundle.HttpClient,bundle_16=bundle.Injectable,bundle_17=bundle.injector,bundle_18=bundle.factoryCreator,bundle_19=bundle.ElementRef;exports.default=bundle$1,exports.Utils=bundle_1,exports.Watcher=bundle_2,exports.KeyWatcher=bundle_3,exports.Compile=bundle_4,exports.CompileUtil=bundle_5,exports.CompileUtilForRepeat=bundle_6,exports.RouteModule=bundle_7,exports.NvLocation=bundle_8,exports.Component=bundle_9,exports.setState=bundle_10,exports.Directive=bundle_11,exports.InDiv=bundle_12,exports.NvModule=bundle_13,exports.factoryModule=bundle_14,exports.HttpClient=bundle_15,exports.Injectable=bundle_16,exports.injector=bundle_17,exports.factoryCreator=bundle_18,exports.ElementRef=bundle_19;

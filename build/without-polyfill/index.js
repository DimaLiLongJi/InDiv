"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var easierCookie=_interopDefault(require("easier-cookie"));require("reflect-metadata");var axios=_interopDefault(require("axios")),rxjs=_interopDefault(require("rxjs"));function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var bundle=createCommonjsModule(function(e,t){function n(e){return e&&"object"===_typeof(e)&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=n(easierCookie),o=n(axios),i=function(){function e(){this.toString=Object.prototype.toString}return e.prototype.setCookie=function(e,t,n){r.set(e,t,n)},e.prototype.getCookie=function(e){return r.get(e)},e.prototype.removeCookie=function(e){return r.remove(e)},e.prototype.buildQuery=function(e){if(!(e&&e instanceof Object))return"";var t="?";for(var n in e)e[n]instanceof Object?t+=n+"="+JSON.stringify(e[n])+"&":t+=n+"="+e[n].toString()+"&";return t.slice(0,t.length-1)},e.prototype.getQuery=function(e){for(var t=window.location.search.replace("?","").split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("=");n[o[0]]=o[1]}return n[e]?n[e]:""},e.prototype.isFunction=function(e){return"[object Function]"===this.toString.call(e)},e.prototype.isEqual=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=_typeof(e);return("function"===o||"object"===o||"object"===_typeof(t))&&this.deepIsEqual(e,t,n,r)},e.prototype.deepIsEqual=function(e,t,n,r){var o=this.toString.call(e);if(o!==this.toString.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var i="[object Array]"===o;if(!i){if("object"!==_typeof(e)||"object"!==_typeof(t))return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(this.isFunction(a)&&a instanceof a&&this.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),i){if((u=e.length)!==t.length)return!1;for(;u--;)if(!this.isEqual(e[u],t[u],n,r))return!1}else{var c=Object.keys(e),p=void 0;if(u=c.length,Object.keys(t).length!==u)return!1;for(;u--;)if(p=c[u],!t.hasOwnProperty(p)||!this.isEqual(e[p],t[p],n,r))return!1}return n.pop(),r.pop(),!0},e.prototype.formatInnerHTML=function(e){return e=(e=e.replace(/(\n\s*)/g,"")).replace(/^[^\S\n]+/gm,"")},e.prototype.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(),a=new i,s=function(){function e(e,t,n){this.data=e,this.watcher=t,this.render=n,this.watchData(this.data)}return e.prototype.watchData=function(t){if(t&&"object"===_typeof(t)){var r=this,e=function(e){var n=t[e];r.watchData(n),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return n},set:function(e){var t;a.isEqual(e,n)||(r.watcher&&(t=JSON.parse(JSON.stringify(r.data))),n=e,r.watchData(n),r.watcher&&r.watcher(t),r.render&&r.render())}})};for(var n in t)e(n)}},e}(),c=function(e){this.tagName=e.tagName,this.node=e.node,this.parentNode=e.parentNode,this.attributes=e.attributes,this.childNodes=e.childNodes,this.nodeValue=e.nodeValue,this.type=e.type,this.value=e.value,this.repeatData=e.repeatData,this.eventTypes=e.eventTypes,this.key=e.key,this.checked=!1};function p(e,t){var n,r,o,i,a,s,u=[];return e.childNodes&&Array.from(e.childNodes).forEach(function(e){u.push(p(e,t))}),new c({tagName:e.tagName,node:e,parentNode:e.parentNode,attributes:(r=e,o=t,i=r.attributes,a=[],s=o?o(r):null,i&&Array.from(i).forEach(function(e){s&&-1===s.indexOf(e.name)||a.push({name:e.name,value:e.value})}),a),childNodes:u,nodeValue:e.nodeValue,type:(n=e,1===n.nodeType?"element":3===n.nodeType?"text":11===n.nodeType?"document-fragment":""),value:e.value,repeatData:e.repeatData?e.repeatData:null,eventTypes:e.eventTypes?e.eventTypes:null,key:e.indiv_repeat_key?e.indiv_repeat_key:null})}function $(o,i,a,s){0<o.childNodes.length&&o.childNodes.forEach(function(t,e){var n=i.childNodes.find(function(e){return e.node.isEqualNode(t.node)&&e.key===t.key&&!e.checked||e.tagName===t.tagName&&e.key===t.key&&!e.checked});if(n){var r=i.childNodes.findIndex(function(e){return e===n});r!==e&&a.push({type:1,newIndex:r,oldVnode:t.node,parentNode:o.node,originVnode:o,changedVnode:t}),u(t,n,a,s),n.checked=!0}n||a.push({type:0,node:t.node,parentNode:o.node,originVnode:o,changedVnode:t})}),0<i.childNodes.length&&i.childNodes.forEach(function(e,t){e.checked||(a.push({type:1,newIndex:t,oldVnode:e.node,parentNode:o.node,originVnode:o,changedVnode:e}),e.checked=!0)})}function u(t,e,n,r){if(!n)throw new Error("patchList can not be null, diffVnode must need an Array");if("document-fragment"===e.type)return e.childNodes.forEach(function(e){e.parentNode=t.node}),void $(t,e,n,r);var o,i,a,s,u,c,p,l,d,h,f,v,m,y,g,b;o=t,a=n,(i=e).attributes.forEach(function(t){var e=o.attributes.find(function(e){return e.name===t.name});e&&e.value===t.value||a.push({type:2,node:o.node,newValue:t,oldValue:e,originVnode:o,changedValue:t})}),o.attributes.forEach(function(t){i.attributes.find(function(e){return e.name===t.name})||a.push({type:3,node:o.node,oldValue:t,originVnode:o,changedValue:t})}),u=e,c=n,(s=t).nodeValue!==u.nodeValue&&c.push({type:4,node:s.node,newValue:u.nodeValue,oldValue:s.nodeValue,originVnode:s,changedValue:u.nodeValue}),"INPUT"!==t.tagName&&"TEXTAREA textarea"!==t.tagName&&"INPUT"!==t.tagName||(l=e,d=n,(p=t).value!==l.value&&d.push({type:5,node:p.node,newValue:l.value,oldValue:p.value,originVnode:p,changedValue:l.value})),h=t,f=e,n.push({type:6,node:h.node,newValue:f.repeatData,originVnode:h,changedValue:f.repeatData}),v=t,m=e,y=n,g=JSON.parse(v.eventTypes),b=JSON.parse(m.eventTypes),g&&0<g.length&&g.forEach(function(t){(!b||b.length<=0)&&y.push({type:7,node:v.node,eventType:t,newValue:v.node["event"+t]}),b&&0<b.length&&!b.find(function(e){return e===t})&&y.push({type:7,node:v.node,eventType:t,newValue:v.node["event"+t]})}),b&&0<b.length&&b.forEach(function(t){if((!g||g.length<=0)&&y.push({type:8,node:v.node,eventType:t,newValue:m.node["event"+t]}),g&&0<g.length){var e=g.find(function(e){return e===t});e||y.push({type:8,node:v.node,eventType:t,newValue:m.node["event"+t]}),e&&v.node.getAttribute("nv-on:"+e)!==m.node.getAttribute("nv-on:"+e)&&(y.push({type:7,node:v.node,eventType:t,newValue:v.node["event"+t]}),y.push({type:8,node:v.node,eventType:t,newValue:m.node["event"+t]}))}}),m.eventTypes!==v.eventTypes&&y.push({type:9,node:v.node,newValue:m.eventTypes,originVnode:v,changedValue:m.eventTypes}),r&&!r(t,e)||$(t,e,n,r)}var b=function(){function e(e){this.$fragment=e}return e.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},e.prototype._getVMVal=function(e,t){var n=t.replace("()","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMRepeatVal=function(n,e,r){var o;return e.replace("()","").split(".").forEach(function(e,t){o=e!==r||0!==t?o[e]:n}),o},e.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMFunctionArguments=function(e,t,n,r,o){var i=t.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),a=[],s=this;return i.forEach(function(t){return""!==t&&("$element"===t?a.push(n):"true"===t||"false"===t?a.push("true"===t):"null"===t?a.push(null):"undefined"===t?a.push(void 0):s.isFromState(e.state,t)?a.push(s._getVMVal(e.state,t)):/^\'.*\'$/.test(t)?a.push(t.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(t)&&/^[0-9]*$/.test(t)?a.push(Number(t)):0===t.indexOf(r)||0===t.indexOf(r+".")?a.push(s._getVMRepeatVal(o,t,r)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return a.push(s._getValueByValue(n.repeatData[e],t,e))})))}),a},e.prototype._setValueByValue=function(e,t,n,r){var o,i=t.replace("()","").split("."),a=e;i.forEach(function(e,t){if(e===n&&0===t)return o=e;t<i.length&&(o=e),t<i.length-1&&(a=a[e])}),o&&(a[o]=r)},e.prototype._setVMVal=function(n,e,r){var o=null,i=e.split(".");1===i.length?n.state[e]=r:i.forEach(function(e,t){0===t&&(o=n.state[e]),0!==t&&t!==i.length-1&&(o=o[e]),t===i.length-1&&(o[e]=r)})},e.prototype.bind=function(e,t,n,r,o,i,a,s){var u,c=e.repeatData[t];if(/^(\@)/.test(r)){if("model"===n)throw new Error("directive: nv-model can't use "+r+" as value");var p=this._getVMFunction(i,r),l=this._getVMFunctionArguments(i,r,e,t,s);u=p.apply(i,l)}else if(0===r.indexOf(t)||0===r.indexOf(t+"."))u=this._getVMRepeatVal(c,r,t);else if(this.isFromState(i.state,r))u=this._getVMVal(i.state,r);else if("$index"===r)u=o;else if(/^\'.*\'$/.test(r))u=r.match(/^\'(.*)\'$/)[1];else if(!/^\'.*\'$/.test(r)&&/^[0-9]*$/g.test(r))u=Number(r);else if("true"===r||"false"===r)u="true"===r;else if("null"===r)u=null;else{if("undefined"!==r)throw new Error("directive: nv-"+n+" can't use recognize this value "+r);u=void 0}e.hasChildNodes()||this.templateUpdater(e,c,t,i);var d=this[n+"Updater"];switch(n){case"model":var h=void 0;h=0===r.indexOf(t)||0===r.indexOf(t+".")?a:this._getVMVal(i.state,r),d&&d.call(this,e,u,r,t,o,h,i);break;case"text":case"html":case"if":case"class":case"key":d&&d.call(this,e,u);break;default:this.commonUpdater.call(this,e,u,n)}},e.prototype.templateUpdater=function(e,t,n,r){var o=e.textContent;if(/\{\{(.*)\}\}/g.test(o)){var i=o.match(/(\{\{[^\{\}]+?\}\})/g);if(i&&0<i.length)for(var a=0;a<i.length;a++){var s=i[a].replace("{{","").replace("}}",""),u=null;if(/^(\@)/.test(s)){var c=this._getVMFunction(r,s),p=this._getVMFunctionArguments(r,s,e,n,t);u=c.apply(r,p)}else if(0===s.indexOf(n)||0===s.indexOf(n+"."))u=this._getVMRepeatVal(t,s,n);else{if(!this.isFromState(r.state,s))throw new Error("directive: {{"+s+"}} can't use recognize "+s);u=this._getVMVal(r.state,s)}e.textContent=e.textContent.replace(i[a],u)}}},e.prototype.modelUpdater=function(e,t,n,r,o,i,a){e.value=void 0===t?"":t;var s=this,u=function(e){if(e.preventDefault(),s.isFromState(a.state,n)){if(e.target.value===i)return;s._setVMVal(a,n,e.target.value)}else{if(0!==n.indexOf(r)&&0!==n.indexOf(r+"."))throw new Error("directive: nv-model can't use recognize this value");if("object"!==_typeof(i[o])&&(i[o]=e.target.value),"object"===_typeof(i[o])){var t=s._getValueByValue(i[o],n,r);t=e.target.value,s._setValueByValue(i[o],n,r,t)}}};if(e.addEventListener("input",u),e.eventinput=u,e.eventTypes){var c=JSON.parse(e.eventTypes);c.push("input"),e.eventTypes=JSON.stringify(c)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},e.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},e.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},e.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},e.prototype.isFromState=function(e,t){var n=t.replace("()","").split(".")[0];return e.hasOwnProperty(n)},e.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},e.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},e.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},e.prototype.eventHandler=function(o,i,e,t,a,s){var n=t.split(":")[1],u=this._getVMFunction(i,e),c=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),p=this,r=function(e){var n=this,r=[];c.forEach(function(t){return""!==t&&("$event"===t?r.push(e):"$element"===t?r.push(o):"true"===t||"false"===t?r.push("true"===t):"null"===t?r.push(null):"undefined"===t?r.push(void 0):p.isFromState(i.state,t)?r.push(p._getVMVal(i.state,t)):/^\'.*\'$/.test(t)?r.push(t.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(t)&&/^[0-9]*$/.test(t)?r.push(Number(t)):0===t.indexOf(a)||0===t.indexOf(a+".")?r.push(p._getVMRepeatVal(s,t,a)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return r.push(p._getValueByValue(n.repeatData[e],t,e))})))}),u.apply(i,r)};if(n&&u){if(o.addEventListener(n,r),o["event"+n]=r,o.eventTypes){var l=JSON.parse(o.eventTypes);l.push(n),o.eventTypes=JSON.stringify(l)}o.eventTypes||(o.eventTypes=JSON.stringify([n]))}},e}(),l=function(){function v(e){this.$fragment=e}return v.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},v.prototype._getVMVal=function(e,t){var n=t.replace("()","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},v.prototype._getVMRepeatVal=function(e,t){var n=t.split(" ");return this._getVMVal(e.state,n[3])},v.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},v.prototype._getVMFunctionArguments=function(t,e,n){var r=this,o=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),i=[];return o.forEach(function(e){return""!==e&&("$element"===e?i.push(n):"true"===e||"false"===e?i.push("true"===e):"null"===e?i.push(null):"undefined"===e?i.push(void 0):r.isFromState(t.state,e)?i.push(r._getVMVal(t.state,e)):/^\'.*\'$/.test(e)?i.push(e.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(e)&&/^[0-9]*$/.test(e)?i.push(Number(e)):void 0)}),i},v.prototype._setVMVal=function(n,e,r){var o=null,i=e.split(".");1===i.length?n.state[e]=r:i.forEach(function(e,t){0===t&&(o=n.state[e]),0!==t&&t!==i.length-1&&(o=o[e]),t===i.length-1&&(o[e]=r)})},v.prototype.bind=function(e,t,n,r){var o=this[r+"Updater"];if(this.isRepeatNode(e))switch(r){case"repeat":o&&o.call(this,e,this._getVMRepeatVal(t,n),n,t)}else{var i=null;if(/^(\@)/.test(n)){if("model"===r)throw new Error("directive: nv-model can't use "+n+" as value");var a=this._getVMFunction(t,n),s=this._getVMFunctionArguments(t,n,e);i=a.apply(t,s)}else if(this.isFromState(t.state,n))i=this._getVMVal(t.state,n);else if(/^\'.*\'$/.test(n))i=n.match(/^\'(.*)\'$/)[1];else if(!/^\'.*\'$/.test(n)&&/^[0-9]*$/g.test(n))i=Number(n);else if("true"===n||"false"===n)i="true"===n;else if("null"===n)i=null;else{if("undefined"!==n)throw new Error("directive: nv-"+r+" can't use recognize this value "+n);i=void 0}switch(r){case"model":o&&o.call(this,e,i,n,t);break;case"text":case"html":case"if":case"class":case"key":o&&o.call(this,e,i);break;default:this.commonUpdater.call(this,e,i,r)}}},v.prototype.templateUpdater=function(e,t,n){var r=n.replace("{{","").replace("}}",""),o=null;if(/^(\@)/.test(r)){var i=this._getVMFunction(t,r),a=this._getVMFunctionArguments(t,r,e);o=i.apply(t,a)}else{if(!this.isFromState(t.state,r))throw new Error("directive: "+n+" can't use recognize this value");o=this._getVMVal(t.state,r)}e.textContent=e.textContent.replace(n,o)},v.prototype.modelUpdater=function(e,t,n,r){var o=this;e.value=void 0===t?"":t;var i=function(e){e.preventDefault(),o.isFromState(r.state,n)&&o._setVMVal(r,n,e.target.value)};if(e.addEventListener("input",i),e.eventinput=i,e.eventTypes){var a=JSON.parse(e.eventTypes);a.push("input"),e.eventTypes=JSON.stringify(a)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},v.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},v.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},v.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},v.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},v.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},v.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},v.prototype.repeatUpdater=function(r,s,u,c){var p=this;if(s){if(s&&!(s instanceof Array))throw new Error("compile error: nv-repeat need an Array!");var l=u.split(" ")[1];s.forEach(function(o,i){var e={};e[l]=o,e.$index=i;var a=p.cloneNode(r,e),t=a.attributes,n=a.textContent;p.$fragment.insertBefore(a,r),p.isTextNode(a)&&/\{\{(.*)\}\}/g.test(n)&&new b(p.$fragment).templateUpdater(a,o,l,c),t&&Array.from(t).forEach(function(e){var t=e.name;if(p.isDirective(t)&&"nv-repeat"!==t){var n=t.substring(3),r=e.value;p.isEventDirective(n)?new b(p.$fragment).eventHandler(a,c,r,n,l,o):new b(p.$fragment).bind(a,l,n,r,i,c,s,o)}}),a.hasChildNodes()&&p.$fragment.contains(a)&&p.repeatChildrenUpdater(a,o,u,i,c,s)})}},v.prototype.repeatChildrenUpdater=function(s,u,c,p,l,d){var h=this,f=c.split(" ")[1];Array.from(s.childNodes).forEach(function(o){if(h.isElementNode(o)){var e=l.$declarationMap.get(o.tagName.toLocaleLowerCase());e&&"nvComponent"===e.nvType&&(o.isComponent=!0)}o.repeatData=s.repeatData||{},o.repeatData[f]=u,o.repeatData.$index=p,h.isRepeatProp(o)&&o.setAttribute("_prop-"+f,JSON.stringify(u));var t=o.attributes,n=o.textContent;h.isTextNode(o)&&/\{\{(.*)\}\}/g.test(n)&&new b(s).templateUpdater(o,u,f,l),t&&Array.from(t).forEach(function(e){var t=e.name,n=e.value,r=t.substring(3);h.isDirective(t)&&"nv-repeat"!==t&&(new RegExp("(^"+f+")|(^@)").test(n)||h.isFromState(l.state,n))&&(h.isEventDirective(r)?new b(s).eventHandler(o,l,n,r,f,u):new b(s).bind(o,f,r,n,p,l,d,u))}),o.hasChildNodes()&&!h.isRepeatNode(o)&&s.contains(o)&&h.repeatChildrenUpdater(o,u,c,p,l,d);var r=o.attributes;if(r&&s.contains(o)){var i=Array.from(r).find(function(e){return h.isDirective(e.name)&&"nv-repeat"===e.name});if(i){var a=i.value.split(" ")[3];h.isFromState(l.state,a)&&(new v(s).bind(o,l,i.value,i.name.substring(3)),s.contains(o)&&s.removeChild(o)),new RegExp("(^"+f+")").test(a)&&(new v(s).repeatUpdater(o,h._getValueByValue(u,a,f),i.value,l),s.contains(o)&&s.removeChild(o))}}})},v.prototype.eventHandler=function(r,o,e,t){var n=t.split(":")[1],i=this._getVMFunction(o,e),a=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),s=this,u=function(t){var n=[];a.forEach(function(e){return""!==e&&("$event"===e?n.push(t):"$element"===e?n.push(r):"true"===e||"false"===e?n.push("true"===e):"null"===e?n.push(null):"undefined"===e?n.push(void 0):s.isFromState(o.state,e)?n.push(s._getVMVal(o.state,e)):/^\'.*\'$/.test(e)?n.push(e.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(e)&&/^[0-9]*$/.test(e)?n.push(Number(e)):void 0)}),i.apply(o,n)};if(n&&i){if(r.addEventListener(n,u),r["event"+n]=u,r.eventTypes){var c=JSON.parse(r.eventTypes);c.push(n),r.eventTypes=JSON.stringify(c)}r.eventTypes||(r.eventTypes=JSON.stringify([n]))}},v.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},v.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},v.prototype.isElementNode=function(e){return 1===e.nodeType},v.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},v.prototype.isRepeatProp=function(e){var t=e.attributes;return!!t&&!!Array.from(t).find(function(e){return/^\{(.+)\}$/.test(e.value)})},v.prototype.isTextNode=function(e){return 3===e.nodeType},v.prototype.isFromState=function(e,t){var n=t.replace("()","").split(".")[0];return e.hasOwnProperty(n)},v.prototype.cloneNode=function(t,e){var n=t.cloneNode(!0);return t.eventTypes&&(JSON.parse(t.eventTypes).forEach(function(e){n.addEventListener(e,t["event"+e]),n["event"+e]=t["event"+e]}),n.eventTypes=t.eventTypes),e&&(n.repeatData=e),t.isComponent&&(n.isComponent=!0),n},v}();function d(e){var t=[],n=["nv-model","nv-text","nv-html","nv-if","nv-key"];return e.attributes&&Array.from(e.attributes).forEach(function(e){/^nv\-.*/.test(e.name)&&-1===n.indexOf(e.name)&&t.push(e.name.replace("nv-",""))}),t}var h=new i,f=function(){function e(e,t){var n=this;this.needDiffChildCallback=function(e,t){return t.node.isComponent&&e.node?!(e.node.isComponent=!0):e.tagName!==t.tagName||t.tagName!==n.$vm.$vm.getRouteDOMKey().toLocaleUpperCase()},this.$vm=t,this.$el=this.isElementNode(e)?e:document.querySelector(e)}return e.prototype.startCompile=function(){if(!this.$el)throw new Error("class Compile need el in constructor");this.$fragment=this.node2Fragment(),this.init(),this.saveVnode||(this.saveVnode=p(this.$el,d));var e,t=p(this.$fragment,d),n=[];u(this.saveVnode,t,n,this.needDiffChildCallback),(e=n).sort(function(e,t){return e.type===t.type&&e.newIndex&&t.newIndex?e.newIndex-t.newIndex:e.type-t.type}),e.forEach(function(e){switch(e.type){case 0:var t=e.originVnode.childNodes.indexOf(e.changedVnode);e.originVnode.childNodes.splice(t,1),e.parentNode.removeChild(e.node);break;case 1:var n=e.originVnode.childNodes.indexOf(e.changedVnode);Array.from(e.parentNode.children).indexOf(e.oldVnode)!==e.newIndex&&(e.parentNode.contains(e.oldVnode)&&(e.parentNode.removeChild(e.oldVnode),e.originVnode.childNodes.splice(n,1)),e.parentNode.childNodes[e.newIndex]?(e.parentNode.insertBefore(e.oldVnode,e.parentNode.childNodes[e.newIndex]),e.originVnode.childNodes.splice(e.newIndex,0,e.changedVnode)):(e.parentNode.appendChild(e.oldVnode),e.originVnode.childNodes.push(e.changedVnode)));break;case 2:e.oldValue||e.originVnode.attributes.push(e.changedValue),e.oldValue&&(e.oldValue.value=e.changedValue.value),e.node.setAttribute(e.newValue.name,e.newValue.value);break;case 3:var r=e.originVnode.attributes.indexOf(e.changedVnode);e.originVnode.attributes.splice(r,1),e.node.removeAttribute(e.oldValue.name);break;case 4:e.originVnode.nodeValue=e.changedValue,e.node.nodeValue=e.newValue;break;case 5:e.originVnode.value=e.changedValue,e.node.value=e.newValue;break;case 6:e.originVnode.repeatData=e.changedValue,e.node.repeatData=e.newValue;break;case 7:e.node.removeEventListener(e.eventType,e.newValue);break;case 8:e.node.addEventListener(e.eventType,e.newValue);break;case 9:e.originVnode.eventTypes=e.changedValue,e.node.eventTypes=e.newValue}}),this.$fragment=null},e.prototype.init=function(){this.compileElement(this.$fragment)},e.prototype.compileElement=function(e){var t=document.createElement("div");t.innerHTML=h.formatInnerHTML(this.$vm.$template);var n=t.childNodes;this.recursiveDOM(n,e)},e.prototype.recursiveDOM=function(e,a){var s=this;Array.from(e).forEach(function(e){if(s.isElementNode(e)){var t=s.$vm.$declarationMap.get(e.tagName.toLocaleLowerCase());t&&"nvComponent"===t.nvType&&(e.isComponent=!0)}e.hasChildNodes()&&!s.isRepeatNode(e)&&s.recursiveDOM(e.childNodes,e),a.appendChild(e);var n=e.textContent;if(s.isElementNode(e)&&s.compile(e,a),s.isTextNode(e)&&/\{\{(.*)\}\}/g.test(n)){var r=n.match(/(\{\{[^\{\}]+?\}\})/g),o=r.length;if(r&&0<o)for(var i=0;i<o;i++)s.compileText(e,r[i])}s.isRepeatNode(e)&&a.contains(e)&&a.removeChild(e)})},e.prototype.compile=function(i,a){var s=this,e=i.attributes;e&&Array.from(e).forEach(function(e){var t=e.name;if(s.isDirective(t)){var n=t.substring(3),r=e.value,o=new l(a);s.isEventDirective(n)?o.eventHandler(i,s.$vm,r,n):o.bind(i,s.$vm,r,n)}})},e.prototype.node2Fragment=function(){return document.createDocumentFragment()},e.prototype.compileText=function(e,t){new l(this.$fragment).templateUpdater(e,this.$vm,t)},e.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},e.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},e.prototype.isElementNode=function(e){return"string"!=typeof e&&1===e.nodeType},e.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},e.prototype.isTextNode=function(e){return 3===e.nodeType},e}(),v=function(e,t){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function m(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(a=(i<3?o(a):3<i?o(t,n,a):o(t,n))||a);return 3<i&&a&&Object.defineProperty(t,n,a),a}function y(e,t){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(i,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}o((u=u.apply(i,a||[])).next())})}function w(n,r){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function R(t){var e=Reflect.getMetadata("design:paramtypes",t);e&&e.length&&e.forEach(function(e){if(e===t)throw new Error("不可以依赖自身");t._needInjectedClass?t._needInjectedClass.push(e):t._needInjectedClass=[e]})}var V=function(){function e(){this.providerMap=new Map,this.instanceMap=new Map}return e.prototype.setProvider=function(e,t){this.providerMap.has(e)||this.providerMap.set(e,t)},e.prototype.getProvider=function(e){return this.providerMap.get(e)},e.prototype.setInstance=function(e,t){this.instanceMap.has(e)||this.instanceMap.set(e,t)},e.prototype.getInstance=function(e){return this.instanceMap.has(e)?this.instanceMap.get(e):null},e}(),M=new V;function C(t){return function(e){R(e),e.isSingletonMode=!0,t&&!1===t.isSingletonMode&&(e.isSingletonMode=!1),t&&t.providedIn&&"root"===t.providedIn&&M.setProvider(e,e)}}function E(s,u,c){var p=[],e=[];return s._needInjectedClass&&(e=s._needInjectedClass),s.injectTokens&&(e=s.injectTokens),0===e.length||e.forEach(function(e){if(c&&c.has(e))return p.push(c.get(e));if(s.prototype.privateInjector){var t=s.prototype.privateInjector.getProvider(e);if(t&&!t.useClass&&!t.useValue)return p.push(_(t,u,c));if(t&&t.useClass)return p.push(_(t.useClass,u,c));if(t&&t.useValue)return p.push(t.useValue)}var n=null,r=null;if(u&&u.getProvider(e))n=u.getProvider(e),r=u;else{if(!M||!M.getProvider(e))throw new Error("injector injects service error: can't find provide: "+e.name+" in constructor "+s);n=M.getProvider(e),r=M}var o=null;if(!n||n.useClass||n.useValue||(o=n),n&&n.useClass&&(o=n.useClass),n&&n.useValue)return p.push(n.useValue);if(!o)throw new Error("injector injects service error: can't find provide: "+e.name+" in constructor "+s);if(!o.isSingletonMode)return p.push(_(o,u,c));if(o.isSingletonMode){var i=r.getInstance(e)?r.getInstance(e):null;if(i&&p.push(i),!i){var a=_(o,u,c);r.setInstance(e,a),p.push(a)}}}),p}function _(e,t,n){var r=E(e,t,n);return Reflect.construct(e,r)}function O(e,t,n){var r=new Map;return n&&r.set(T,n),function(e,t){if(e.$providers)for(var n=t||M,r=e.$providers.length,o=0;o<r;o++){var i=e.$providers[o];i.provide?(i.useClass||i.useValue)&&n.setProvider(i.provide,i):n.setProvider(i,i)}}(e.prototype,t),function(n,e,t){if(n.$imports)for(var r=n.$imports.length,o=0;o<r;o++){var i=O(n.$imports[o],t,e);if(i.$exportsList)for(var a=i.$exportsList.length,s=function(e){var t=i.$exportsList[e];n.$declarations&&!n.$declarations.find(function(e){return e.$selector===t.$selector})&&n.$declarations.push(t)},u=0;u<a;u++)s(u)}}(e.prototype,n,t),function(n){if(n.$declarations)for(var e=n.$declarations.length,t=function(e){var t=n.$declarations[e];n.$declarations.forEach(function(e){t.prototype.$declarationMap.has(e.$selector)||t.prototype.$declarationMap.set(e.$selector,e)})},r=0;r<e;r++)t(r)}(e.prototype),function(a,s,u){if(a.$exports)for(var e=a.$exports.length,t=function(e){var t=a.$exports[e];if("nvModule"===t.nvType)for(var n=O(t,u,s),r=n.$exportsList.length,o=function(e){var t=n.$exportsList[e];a.$exportsList.find(function(e){return e.$selector===t.$selector})||a.$exportsList.push(t)},i=0;i<r;i++)o(i);"nvModule"!==t.nvType&&(a.$exportsList.find(function(e){return e.$selector===t.$selector})||a.$exportsList.push(t))},n=0;n<e;n++)t(n)}(e.prototype,n,t),_(e,t,r)}function x(n){return function(e){R(e),e.nvType="nvModule";var t=e.prototype;t.privateInjector=new V,n.imports&&(t.$imports=n.imports),n.declarations&&(t.$declarations=n.declarations),n.providers&&(t.$providers=n.providers),n.exports&&(t.$exports=n.exports,t.$exportsList=[]),n.bootstrap&&(t.$bootstrap=n.bootstrap)}}var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function n(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(HTMLElement),j=new i,T=function(){function c(){this.modalList=[],this.$routeDOMKey="router-render",this.$rootModule=null,j.isBrowser()&&(this.rootDom=document.querySelector("#root"),this.render=q,this.reRender=q)}return c.prototype.use=function(e){return e.bootstrap(this),this.modalList.push(e),this.modalList.length-1},c.prototype.setComponentRender=function(e,t){this.render=e,this.reRender=t||e},c.prototype.getComponentRender=function(){return{render:this.render,reRender:this.reRender}},c.prototype.getBootstrapComponent=function(){return this.bootstrapComponent},c.prototype.setRouteDOMKey=function(e){this.$routeDOMKey=e},c.prototype.getRouteDOMKey=function(){return this.$routeDOMKey},c.prototype.getRootModule=function(){return this.$rootModule},c.prototype.getDeclarations=function(){return this.$declarations},c.prototype.bootstrapModule=function(e){if(!e)throw new Error("must send a root module");this.$rootModule=O(e,null,this),this.$declarations=this.$rootModule.$declarations.slice()},c.prototype.init=function(){if(j.isBrowser()){if(!this.$rootModule)throw new Error("must use bootstrapModule to declare a root NvModule before init");this.renderModuleBootstrap()}},c.prototype.renderComponent=function(a,s,u){return g(this,void 0,void 0,function(){var t,n,r,o,i;return w(this,function(e){switch(e.label){case 0:if((t=new Map).set(c,this),t.set(N,s),n=u?u.privateInjector:null,(r=_(a,n,t)).$vm=this,u?u.$declarations.forEach(function(e){r.$declarationMap.has(e.$selector)||r.$declarationMap.set(e.$selector,e)}):this.$rootModule.$declarations.forEach(function(e){r.$declarationMap.has(e.$selector)||r.$declarationMap.set(e.$selector,e)}),r.render=this.render.bind(r),r.reRender=this.reRender.bind(r),r.otherInjector=n,r.nvOnInit&&r.nvOnInit(),r.watchData&&r.watchData(),!r.$template)throw new Error("must decaler this.$template in bootstrap()");return(o=r.$template)&&"string"==typeof o&&s?(r.nvBeforeMount&&r.nvBeforeMount(),[4,this.replaceDom(r,s)]):[3,2];case 1:return(i=e.sent()).nvAfterMount&&i.nvAfterMount(),[2,i];case 2:throw new Error("renderBootstrap failed: template or rootDom is not exit")}})})},c.prototype.renderModuleBootstrap=function(){return g(this,void 0,void 0,function(){var t,n;return w(this,function(e){switch(e.label){case 0:if(!this.$rootModule.$bootstrap)throw new Error("need bootstrap for render Module Bootstrap");return t=this.$rootModule.$bootstrap,[4,(n=this).renderComponent(t,this.rootDom)];case 1:return n.bootstrapComponent=e.sent(),[2,this.bootstrapComponent]}})})},c.prototype.replaceDom=function(e,t){return e.renderDom=t,e.render()},c}(),D=new i;function L(e,t){return D.isFunction(e)?e.bind(t):e}var S=new i;function P(e,o){var i=o.$directiveList.slice();!function(t,d){d.$directiveList=[];var h=t.querySelectorAll(d.$vm.getRouteDOMKey())[0];d.$declarationMap.forEach(function(p,l){if("nvDirective"===p.nvType){var e=t.querySelectorAll("*["+l+"]");Array.from(e).forEach(function(n){if(!h||!h.contains(n)){var e=n.getAttribute(l),t=null;if(e){var r=e.split("."),o=r[0];if(d.compileUtil.isFromState(d.state,e))t=d.compileUtil._getVMVal(d.state,e);else if(/^(\@.).*\(.*\)$/.test(e)){var i=new b,a=i._getVMFunction(d,e),s=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),u=[];s.forEach(function(t){return""!==t&&("$element"===t?u.push(n):"true"===t||"false"===t?u.push("true"===t):"null"===t?u.push(null):"undefined"===t?u.push(void 0):i.isFromState(d.state,t)?u.push(i._getVMVal(d.state,t)):/^\'.*\'$/.test(t)?u.push(t.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(t)&&/^[0-9]*$/.test(t)?u.push(Number(t)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return u.push(i._getValueByValue(n.repeatData[e],t,e))})))});var c=a.apply(d,u);t=c}else/^(\@.).*[^\(.*\)]$/g.test(e)?t=d.compileUtil._getVMVal(d,e.replace(/^(\@)/,"")):n.repeatData&&null!==n.repeatData[o]?t=d.compileUtil._getValueByValue(n.repeatData[o],e,o):/^\'.*\'$/.test(e)?t=e.match(/^\'(.*)\'$/)[1]:!/^\'.*\'$/.test(e)&&/^[0-9]*$/.test(e)?t=Number(e):"true"===e||"false"===e?t="true"===e:"null"===e?t=null:"undefined"===e&&(t=void 0);d.$directiveList.push({dom:n,props:t,scope:null,constructorFunction:p})}else d.$directiveList.push({dom:n,props:t,scope:null,constructorFunction:p})}})}})}(e,o);for(var t=o.$directiveList.length,n=function(e){var t=o.$directiveList[e],n=i.findIndex(function(e){return e.dom===t.dom}),r=i[n];-1!==n&&i.splice(n,1),r?(t.scope=r.scope,S.isEqual(t.scope.props,t.props)||(t.scope.nvReceiveProps&&t.scope.nvReceiveProps(t.props),t.scope.props=t.props)):t.scope=function(e,t,n,r){var o=new Map;r.$vm&&o.set(T,r.$vm),o.set(N,n);var i=_(e,r.otherInjector,o);return i.props=t,i.renderDom=n,r.$declarationMap.forEach(function(e,t){i.$declarationMap.has(t)||i.$declarationMap.set(t,e)}),i.otherInjector=r.otherInjector,i}(t.constructorFunction,t.props,t.dom,o),t.scope.$vm=o.$vm,t.scope.nvOnInit&&!r&&t.scope.nvOnInit(),t.scope.nvBeforeMount&&t.scope.nvBeforeMount()},r=0;r<t;r++)n(r);var a=i.length;for(r=0;r<a;r++){var s=i[r];s.scope.nvOnDestory&&s.scope.nvOnDestory()}}var k=new i;function I(e,o){var i=o.$componentList.slice();!function(r,g){g.$componentList=[];var o=r.querySelectorAll(g.$vm.getRouteDOMKey())[0];g.$declarationMap.forEach(function(n,e){if("nvComponent"===n.nvType){var t=r.getElementsByTagName(e);Array.from(t).forEach(function(v){if((!o||!o.contains(v))&&v.isComponent){var e=v.attributes,m={};if(e){var t=Array.from(e),y={};t.forEach(function(e){/^\_prop\-(.+)/.test(e.name)&&(y[e.name.replace("_prop-","")]=JSON.parse(e.value),v.removeAttribute(e.name))}),t.forEach(function(e){var n=e.name;if(!/^\_prop\-(.+)/.test(n)){var t=n.split("-");1<t.length&&t.forEach(function(e,t){0===t&&(n=e),0!==t&&(n+=e.toLowerCase().replace(/( |^)[a-z]/g,function(e){return e.toUpperCase()}))});var r,o,i,a=/^\{(.+)\}$/.exec(e.value);if(a){var s=a[1].split("."),u=s[0],c=null;if(g.compileUtil.isFromState(g.state,a[1]))return c=g.compileUtil._getVMVal(g.state,a[1]),void(m[n]=L(c,g));if(/^(\@.).*\(.*\)$/.test(a[1])){var p=new b,l=p._getVMFunction(g,a[1]),d=a[1].replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),h=[];d.forEach(function(t){return""!==t&&("$element"===t?h.push(v):"true"===t||"false"===t?h.push("true"===t):"null"===t?h.push(null):"undefined"===t?h.push(void 0):p.isFromState(g.state,t)?h.push(p._getVMVal(g.state,t)):/^\'.*\'$/.test(t)?h.push(t.match(/^\'(.*)\'$/)[1]):!/^\'.*\'$/.test(t)&&/^[0-9]*$/g.test(t)?h.push(Number(t)):void(v.repeatData&&Object.keys(v.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return h.push(p._getValueByValue(v.repeatData[e],t,e))})))});var f=l.apply(g,h);return void(m[n]=f)}if(/^(\@.).*[^\(.*\)]$/g.test(a[1]))return c=g.compileUtil._getVMVal(g,a[1].replace(/^(\@)/,"")),void(m[n]=L(c,g));if(y.hasOwnProperty(u))return r=s,o=y[u],i=o,r.forEach(function(e,t){0!==t&&(i=i[e])}),c=i,void(m[n]=L(c,g));if(v.repeatData&&null!==v.repeatData[u])return c=g.compileUtil._getValueByValue(v.repeatData[u],a[1],u),void(m[n]=L(c,g));if(/^\'.*\'$/.test(a[1]))return m[n]=a[1].match(/^\'(.*)\'$/)[1];if(!/^\'.*\'$/.test(a[1])&&/^[0-9]*$/.test(a[1]))return m[n]=Number(a[1]);if("true"===a[1]||"false"===a[1])return m[n]="true"===a[1];if("null"===a[1])return m[n]=null;if("undefined"===a[1])return m[n]=void 0}"indiv_repeat_key"!==e.name&&v.removeAttribute(n)}})}g.$componentList.push({dom:v,props:m,scope:null,constructorFunction:n,hasRender:!1}),v.isComponent=!1}})}})}(e,o);for(var t=o.$componentList.length,n=function(e){var t=o.$componentList[e],n=i.findIndex(function(e){return e.dom===t.dom}),r=i[n];-1!==n&&i.splice(n,1),r?(t.scope=r.scope,k.isEqual(t.scope.props,t.props)||(t.scope.nvReceiveProps&&t.scope.nvReceiveProps(t.props),t.scope.props=t.props),t.hasRender=!0):t.scope=function(e,t,n,r){var o=new Map;o&&o.set(T,r.$vm),o.set(N,n);var i=_(e,r.otherInjector,o);return i.props=t,i.renderDom=n,r.$declarationMap.forEach(function(e,t){i.$declarationMap.has(t)||i.$declarationMap.set(t,e)}),i.render=r.$vm.render.bind(i),i.reRender=r.$vm.reRender.bind(i),i.otherInjector=r.otherInjector,i}(t.constructorFunction,t.props,t.dom,o),t.scope.$vm=o.$vm,t.scope.nvOnInit&&!r&&t.scope.nvOnInit(),t.scope.watchData&&t.scope.watchData(),t.scope.nvBeforeMount&&t.scope.nvBeforeMount()},r=0;r<t;r++)n(r);var a=i.length;for(r=0;r<a;r++){var s=i[r];s.scope.nvOnDestory&&s.scope.nvOnDestory()}}function U(o,i){return g(this,void 0,void 0,function(){var t=this;return w(this,function(e){return[2,Promise.resolve().then(function(){return g(t,void 0,void 0,function(){var t,n,r;return w(this,function(e){switch(e.label){case 0:return i.$vm.compile||(i.$vm.compile=new f(o,i.$vm)),i.$vm.compile.startCompile(),[4,function(r,o){return g(this,void 0,void 0,function(){return w(this,function(e){return[2,Promise.resolve().then(function(){P(r,o.$vm);for(var e=o.$vm.$directiveList.length,t=0;t<e;t++){var n=o.$vm.$directiveList[t];n.scope.nvAfterMount&&n.scope.nvAfterMount(),n.scope.nvHasRender&&n.scope.nvHasRender()}return o.$vm}).catch(function(e){throw new Error("directive "+o.$vm.constructor.$selector+" render failed: "+e)})]})})}(o,i)];case 1:for(e.sent(),I(o,i.$vm),t=i.$vm.$componentList.length,n=0;n<t;n++)(r=i.$vm.$componentList[n]).hasRender?r.scope.reRender():(r.scope.render(),r.hasRender=!0),r.scope.nvAfterMount&&r.scope.nvAfterMount();return i.$vm.nvHasRender&&i.$vm.nvHasRender(),[2,i.$vm]}})})}).catch(function(e){throw new Error("component "+i.$vm.constructor.$selector+" render failed: "+e)})]})})}var A="pending",F=function(){function e(e){this.$vm=e,this.resetStatus()}return e.prototype.push=function(e){if(this.taskQueue.push(e),this.renderStatus===A)return this.renderStatus="rendering",this.runTask()},e.prototype.stopTask=function(){this.renderStatus=A},e.prototype.runTask=function(){return g(this,void 0,void 0,function(){var t;return w(this,function(e){switch(e.label){case 0:return[4,U(this.taskQueue[this.queuePointer],this)];case 1:return t=e.sent(),this.nextTask(),[2,t]}})})},e.prototype.nextTask=function(){return g(this,void 0,void 0,function(){return w(this,function(e){return this.taskQueue.length!==this.queuePointer+1?(this.queuePointer++,this.renderStatus===A?[2]:[2,this.runTask()]):(this.resetStatus(),[2])})})},e.prototype.resetStatus=function(){this.renderStatus=A,this.queuePointer=0,this.taskQueue?this.taskQueue.length=0:this.taskQueue=[]},e}();function q(){this.compileUtil=new l;var e=this.renderDom;return this.renderTaskQueue||(this.renderTaskQueue=new F(this)),this.renderTaskQueue.push(e)}var B=new i;function J(i){return function(e){R(e),e.nvType="nvDirective",e.$selector=i.selector;var t=e.prototype;if(t.privateInjector=new V,i.providers&&0<i.providers.length)for(var n=i.providers.length,r=0;r<n;r++){var o=i.providers[r];o.provide?(o.useClass||o.useValue)&&t.privateInjector.setProvider(o.provide,o):t.privateInjector.setProvider(o,o)}t.$declarationMap=new Map}}var W=function(){function e(){}return e.prototype.createRequest=function(e,t){var n=Object.assign({url:e},t);return o.create(n)},e.prototype.request=function(e,t){var n=Object.assign({url:e},t);return rxjs.from(o.request(n))},e.prototype.get=function(e,t){return rxjs.from(o.get(e,t))},e.prototype.delete=function(e,t){return rxjs.from(o.delete(e,t))},e.prototype.head=function(e,t){return rxjs.from(o.head(e,t))},e.prototype.post=function(e,t){return rxjs.from(o.post(e,t))},e.prototype.put=function(e,t){return rxjs.from(o.put(e,t))},e.prototype.patch=function(e,t){return rxjs.from(o.patch(e,t))},e.prototype.createRequestInterceptor=function(e,t){return o.interceptors.request.use(e,t)},e.prototype.removeRequestInterceptor=function(e){o.interceptors.request.eject(e)},e.prototype.createResponseInterceptor=function(e,t){return o.interceptors.response.use(e,t)},e.prototype.removeResponseInterceptor=function(e){o.interceptors.response.eject(e)},e=m([C()],e)}(),H=new i,Q=function(){function e(){}return e.prototype.get=function(){return H.isBrowser()?{path:Z.nvRouteObject.path,query:Z.nvRouteObject.query,params:Z.nvRouteParmasObject,data:Z.nvRouteObject.data,rootPath:Z.nvRootPath}:{}},e.prototype.set=function(e,t,n,r){if(H.isBrowser()){var o="/"===Z.nvRootPath?"":Z.nvRootPath;history.pushState({path:e,query:t,data:n},r,""+o+e+H.buildQuery(t)),Z.nvRouteObject={path:e,query:t,data:n}}},e.prototype.redirectTo=function(e,t,n,r){var o="/"===Z.nvRootPath?"":Z.nvRootPath;history.replaceState({path:e,query:t,data:n},r,""+o+e+H.buildQuery(t)),Z.nvRouteObject={path:e,query:t,data:n},Z.nvRouteParmasObject={}},e=m([C()],e)}(),K=new i,z=function(){function e(e,t){var n=this;this.element=e,this.location=t,this.routeTo=function(){n.resetState(n.props);var e=n.location.get(),t=""+e.path+K.buildQuery(e.query);n.to?(n.from&&t===n.from&&n.location.set(n.to),n.from||n.location.set(n.to)):console.error("Directive router-to on element",n.element,"need a prop")}}return e.prototype.nvOnInit=function(){this.resetState(this.props),this.element.addEventListener("click",this.routeTo,!1)},e.prototype.nvReceiveProps=function(e){this.resetState(e)},e.prototype.nvRouteChange=function(e,t){this.resetState(this.props),this.activeClass&&(t!==this.to||this.element.classList.contains(this.activeClass)||this.element.classList.add(this.activeClass),t!==this.to&&this.element.classList.contains(this.activeClass)&&this.element.classList.remove(this.activeClass))},e.prototype.nvOnDestory=function(){this.element.removeEventListener("click",this.routeTo,!1)},e.prototype.resetState=function(e){this.to=e,this.element.setAttribute("router-link-to",e),this.from=this.element.getAttribute("router-link-from"),this.activeClass=this.element.getAttribute("router-link-active")},e=m([J({selector:"router-to"}),y("design:paramtypes",[N,Q])],e)}(),G=function(){function e(e){this.element=e}return e.prototype.nvOnInit=function(){this.element.setAttribute("router-link-from",this.props)},e.prototype.nvReceiveProps=function(e){this.element.setAttribute("router-link-from",e)},e=m([J({selector:"router-from"}),y("design:paramtypes",[N])],e)}(),X=function(){function e(e){this.element=e}return e.prototype.nvOnInit=function(){this.element.setAttribute("router-link-active",this.props)},e.prototype.nvReceiveProps=function(e){this.element.setAttribute("router-link-active",e)},e=m([J({selector:"router-active"}),y("design:paramtypes",[N])],e)}(),Y=new i,Z={nvRouteObject:{path:null,query:{},data:null},nvRouteParmasObject:{},nvRootPath:"/"},ee=function(){function e(e){this.indivInstance=e,this.routesList=[],this.currentUrl="",this.lastRoute=null,this.hasRenderComponentList=[],this.needRedirectPath=null,this.watcher=!1,this.renderRouteList=[],this.loadModuleMap=new Map,this.canWatch=!1,t.prototype.canWatch&&(t.prototype.canWatch=!1,this.routes||(this.routes=[]),Z.nvRootPath||(Z.nvRootPath="/"),this.indivInstance.setRouteDOMKey("router-render"),Y.isBrowser()&&(this.refresh=this.refresh.bind(this),window.addEventListener("load",this.refresh,!1),window.addEventListener("popstate",function(){var e;e="/"===Z.nvRootPath?location.pathname||"/":""===location.pathname.replace(Z.nvRootPath,"")?"/":location.pathname.replace(Z.nvRootPath,""),Z.nvRouteObject={path:e,query:{},data:null},Z.nvRouteParmasObject={}},!1)))}var t;return(t=e).forRoot=function(e){if(e.rootPath&&(Z.nvRootPath=e.rootPath),e.routeChange&&(t.prototype.routeChange=e.routeChange),!(e.routes&&e.routes instanceof Array))throw new Error("route error: no routes exit");if(t.prototype.routes=e.routes,Y.isBrowser())return t.prototype.canWatch=!0,t},e.prototype.redirectTo=function(e){var t="/"===Z.nvRootPath?"":Z.nvRootPath;history.replaceState(null,null,""+t+e),Z.nvRouteObject={path:e||"/",query:{},data:null},Z.nvRouteParmasObject={}},e.prototype.refresh=function(){if(!Z.nvRouteObject||!this.watcher){var e=void 0;e="/"===Z.nvRootPath?location.pathname||"/":""===location.pathname.replace(Z.nvRootPath,"")?"/":location.pathname.replace(Z.nvRootPath,""),Z.nvRouteObject={path:e,query:{},data:null},Z.nvRouteParmasObject={},this.routeWatcher(),this.watcher=!0}this.currentUrl=Z.nvRouteObject.path||"/",this.routesList=[],this.renderRouteList="/"===this.currentUrl?["/"]:this.currentUrl.split("/"),this.renderRouteList[0]="/",this.distributeRoutes()},e.prototype.routeWatcher=function(){var t=this,n=Z.nvRouteObject;Object.defineProperty(Z,"nvRouteObject",{configurable:!0,enumerable:!0,get:function(){return n},set:function(e){Y.isEqual(e,n)||(n=e,t.refresh())}})},e.prototype.distributeRoutes=function(){return g(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return this.lastRoute&&this.lastRoute!==this.currentUrl?(Z.nvRouteParmasObject={},[4,this.insertRenderRoutes()]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.generalDistributeRoutes()];case 3:e.sent(),e.label=4;case 4:return this.routeChange&&this.routeChange(this.lastRoute,this.currentUrl),this.lastRoute=this.currentUrl,this.needRedirectPath&&(this.redirectTo(this.needRedirectPath),this.needRedirectPath=null),[2]}})})},e.prototype.insertRenderRoutes=function(){return g(this,void 0,void 0,function(){var f,t,v,n,r;return w(this,function(e){switch(e.label){case 0:(f="/"===this.lastRoute?["/"]:this.lastRoute.split("/"))[0]="/",t=function(t){var n,r,o,i,a,s,u,c,p,l,d,h;return w(this,function(e){switch(e.label){case 0:if(n=v.renderRouteList[t],0===t){if(!(r=v.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+v.currentUrl);v.routesList.push(r)}else{if(!((o=v.routesList[t-1].children)&&o instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(i=o.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+v.currentUrl);v.routesList.push(i)}if(n===f[t])return[3,6];if(!(h=v.routesList[t]))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+v.currentUrl);if(d=document.querySelectorAll("router-render")[t-1],!h.component&&!h.redirectTo&&!h.loadChild)throw new Error("route error: path "+h.path+" need a component which has children path or need a redirectTo which has't children path");return/^\/\:.+/.test(h.path)&&!h.redirectTo&&(l=h.path.split("/:")[1],Z.nvRouteParmasObject[l]=n),s=a=null,u="",v.routesList.forEach(function(e,t){0!==t&&(u+=e.path)}),h.component?(c=v.findComponentFromModule(h.component,u),a=c.component,[4,v.instantiateComponent(a,d,c.loadModule)]):[3,2];case 1:s=e.sent(),e.label=2;case 2:return h.loadChild?[4,v.NvModuleFactoryLoader(h.loadChild,u)]:[3,5];case 3:return p=e.sent(),a=p.$bootstrap,[4,v.instantiateComponent(a,d,p)];case 4:s=e.sent(),e.label=5;case 5:if(a){if(!s)throw new Error("route error: path "+h.path+" need a component");v.hasRenderComponentList[t]&&v.hasRenderComponentList.splice(t,0,s),v.hasRenderComponentList[t]||(v.hasRenderComponentList[t]=s),v.routerChangeEvent(t)}if(h.redirectTo&&/^\/.*/.test(h.redirectTo)&&t+1===v.renderRouteList.length)return v.needRedirectPath=h.redirectTo,[2,{value:void 0}];e.label=6;case 6:return n===f[t]&&(h=v.routesList[t],/^\/\:.+/.test(h.path)&&!h.redirectTo&&(l=h.path.split("/:")[1],Z.nvRouteParmasObject[l]=n)),t===v.renderRouteList.length-1&&t<f.length-1&&(d=document.querySelectorAll("router-render")[t],v.routerChangeEvent(t),d&&d.hasChildNodes()&&d.removeChild(d.childNodes[0]),(h=v.routesList[t]).redirectTo&&/^\/.*/.test(h.redirectTo)&&t+1===v.renderRouteList.length)?(v.needRedirectPath=h.redirectTo,[2,{value:void 0}]):[2]}})},v=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.generalDistributeRoutes=function(){return g(this,void 0,void 0,function(){var t,h,n,r;return w(this,function(e){switch(e.label){case 0:t=function(t){var n,r,o,i,a,s,u,c,p,l,d;return w(this,function(e){switch(e.label){case 0:if(n=h.renderRouteList[t],0!==t)return[3,1];if(!(r=h.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in generalDistributeRoutes: "+h.currentUrl);return/^\/\:.+/.test(r.path)&&(d=r.path.split("/:")[1],Z.nvRouteParmasObject[d]=n),Y.isBrowser()?(h.routesList.push(r),h.hasRenderComponentList.push(h.indivInstance.getBootstrapComponent()),t===h.renderRouteList.length-1&&h.routerChangeEvent(t),r.redirectTo&&/^\/.*/.test(r.redirectTo)&&t+1===h.renderRouteList.length?(h.needRedirectPath=r.redirectTo,h.renderRouteList.push(r.redirectTo),[2,{value:void 0}]):[3,7]):[2,{value:void 0}];case 1:if(!((o=h.routesList[t-1].children)&&o instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(i=o.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+h.currentUrl);return a=document.querySelectorAll("router-render")[t-1],u=s=null,c="",h.routesList.forEach(function(e,t){0!==t&&(c+=e.path)}),c+=i.path,i.component?(p=h.findComponentFromModule(i.component,c),s=p.component,[4,h.instantiateComponent(s,a,p.loadModule)]):[3,3];case 2:u=e.sent(),e.label=3;case 3:return i.loadChild?[4,h.NvModuleFactoryLoader(i.loadChild,c)]:[3,6];case 4:return l=e.sent(),s=l.$bootstrap,[4,h.instantiateComponent(s,a,l)];case 5:u=e.sent(),e.label=6;case 6:if(!i.component&&!i.redirectTo&&!i.loadChild)throw new Error("route error: path "+i.path+" need a component which has children path or need a  redirectTo which has't children path");if(/^\/\:.+/.test(i.path)&&(d=i.path.split("/:")[1],Z.nvRouteParmasObject[d]=n),h.routesList.push(i),u&&h.hasRenderComponentList.push(u),t===h.renderRouteList.length-1&&h.routerChangeEvent(t),i.redirectTo&&/^\/.*/.test(i.redirectTo)&&t+1===h.renderRouteList.length)return h.needRedirectPath=i.redirectTo,[2,{value:void 0}];e.label=7;case 7:return[2]}})},h=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.routerChangeEvent=function(n){var r=this;this.hasRenderComponentList.forEach(function(e,t){e.nvRouteChange&&e.nvRouteChange(r.lastRoute,r.currentUrl),r.emitDirectiveEvent(e.$directiveList,"nvRouteChange"),r.emitComponentEvent(e.$componentList,"nvRouteChange"),n+1<=t&&(e.nvOnDestory&&e.nvOnDestory(),r.emitDirectiveEvent(e.$directiveList,"nvOnDestory"),r.emitComponentEvent(e.$componentList,"nvOnDestory"))}),this.hasRenderComponentList.length=n+1},e.prototype.emitComponentEvent=function(e,t){var n=this;"nvRouteChange"===t&&e.forEach(function(e){e.scope.nvRouteChange&&e.scope.nvRouteChange(n.lastRoute,n.currentUrl),n.emitDirectiveEvent(e.scope.$directiveList,t),n.emitComponentEvent(e.scope.$componentList,t)}),"nvOnDestory"===t&&e.forEach(function(e){e.scope.nvOnDestory&&e.scope.nvOnDestory(),n.emitDirectiveEvent(e.scope.$directiveList,t),n.emitComponentEvent(e.scope.$componentList,t)})},e.prototype.emitDirectiveEvent=function(e,t){var n=this;"nvRouteChange"===t&&e.forEach(function(e){e.scope.nvRouteChange&&e.scope.nvRouteChange(n.lastRoute,n.currentUrl)}),"nvOnDestory"===t&&e.forEach(function(e){e.scope.nvOnDestory&&e.scope.nvOnDestory()})},e.prototype.instantiateComponent=function(e,t,n){return this.indivInstance.renderComponent(e,t,n)},e.prototype.NvModuleFactoryLoader=function(r,o){return g(this,void 0,void 0,function(){var t,n;return w(this,function(e){switch(e.label){case 0:return this.loadModuleMap.has(o)?[2,this.loadModuleMap.get(o)]:(t=null,r instanceof Function&&!r.child?[4,r()]:[3,2]);case 1:t=e.sent().default,e.label=2;case 2:return r instanceof Object&&r.child?[4,r.child()]:[3,4];case 3:t=e.sent()[r.name],e.label=4;case 4:if(!t)throw new Error("load child failed, please check your routes.");return n=O(t,t.prototype.privateInjector,this.indivInstance),this.loadModuleMap.set(o,n),[2,n]}})})},e.prototype.findComponentFromModule=function(n,r){if(0===this.loadModuleMap.size)return{component:this.indivInstance.getDeclarations().find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),loadModule:null};var o=null,i=null;return this.loadModuleMap.forEach(function(e,t){new RegExp("^"+t+".*").test(r)&&(o=e.$declarations.find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),i=e)}),o||(o=this.indivInstance.getDeclarations().find(function(e){return e.$selector===n&&"nvComponent"===e.nvType}),i=null),{component:o,loadModule:i}},e=t=m([x({declarations:[z,G,X],providers:[{useClass:Q,provide:Q}],exports:[z,G,X]}),y("design:paramtypes",[T])],e)}();t.Utils=i,t.Watcher=s,t.Compile=f,t.CompileUtil=l,t.CompileUtilForRepeat=b,t.Component=function(i){return function(e){R(e),e.nvType="nvComponent",e.$selector=i.selector;var t=e.prototype;if(t.$template=i.template,t.privateInjector=new V,i.providers&&0<i.providers.length)for(var n=i.providers.length,r=0;r<n;r++){var o=i.providers[r];o.provide?(o.useClass||o.useValue)&&t.privateInjector.setProvider(o.provide,o):t.privateInjector.setProvider(o,o)}t.$declarationMap=new Map,t.$componentList=[],t.$directiveList=[],t.watchData=function(){this.state&&(this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))))}}},t.setState=function(e){if(e&&B.isFunction(e)){var t=e();if(t&&t instanceof Object){if(B.isEqual(this.state,t))return;var n=JSON.parse(JSON.stringify(this.state));Object.assign(n,t),this.state=n,this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))),this.reRender()}}if(e&&e instanceof Object){if(B.isEqual(this.state,e))return;n=JSON.parse(JSON.stringify(this.state)),Object.assign(n,e),this.state=n,this.nvWatchState&&(this.stateWatcher=new s(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new s(this.state,null,this.reRender.bind(this))),this.reRender()}},t.Directive=J,t.InDiv=T,t.ElementRef=N,t.NvModule=x,t.factoryModule=O,t.HttpClient=W,t.Injectable=C,t.inject=E,t.Injector=V,t.rootInjector=M,t.factoryCreator=_,t.injected=R,t.RouteModule=ee,t.NvLocation=Q,t.RouterTo=z,t.RouterFrom=G,t.RouterActive=X}),bundle$1=unwrapExports(bundle),bundle_1=bundle.Utils,bundle_2=bundle.Watcher,bundle_3=bundle.Compile,bundle_4=bundle.CompileUtil,bundle_5=bundle.CompileUtilForRepeat,bundle_6=bundle.Component,bundle_7=bundle.setState,bundle_8=bundle.Directive,bundle_9=bundle.InDiv,bundle_10=bundle.ElementRef,bundle_11=bundle.NvModule,bundle_12=bundle.factoryModule,bundle_13=bundle.HttpClient,bundle_14=bundle.Injectable,bundle_15=bundle.inject,bundle_16=bundle.Injector,bundle_17=bundle.rootInjector,bundle_18=bundle.factoryCreator,bundle_19=bundle.injected,bundle_20=bundle.RouteModule,bundle_21=bundle.NvLocation,bundle_22=bundle.RouterTo,bundle_23=bundle.RouterFrom,bundle_24=bundle.RouterActive;exports.default=bundle$1,exports.Utils=bundle_1,exports.Watcher=bundle_2,exports.Compile=bundle_3,exports.CompileUtil=bundle_4,exports.CompileUtilForRepeat=bundle_5,exports.Component=bundle_6,exports.setState=bundle_7,exports.Directive=bundle_8,exports.InDiv=bundle_9,exports.ElementRef=bundle_10,exports.NvModule=bundle_11,exports.factoryModule=bundle_12,exports.HttpClient=bundle_13,exports.Injectable=bundle_14,exports.inject=bundle_15,exports.Injector=bundle_16,exports.rootInjector=bundle_17,exports.factoryCreator=bundle_18,exports.injected=bundle_19,exports.RouteModule=bundle_20,exports.NvLocation=bundle_21,exports.RouterTo=bundle_22,exports.RouterFrom=bundle_23,exports.RouterActive=bundle_24;

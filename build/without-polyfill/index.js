"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var easierCookie=_interopDefault(require("easier-cookie")),axios=_interopDefault(require("axios")),rxjs=_interopDefault(require("rxjs"));function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}require("reflect-metadata");var bundle=createCommonjsModule(function(e,t){function n(e){return e&&"object"===_typeof(e)&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=n(easierCookie),i=n(axios),o=function(){function e(){this.toString=Object.prototype.toString}return e.prototype.setCookie=function(e,t,n){r.set(e,t,n)},e.prototype.getCookie=function(e){return r.get(e)},e.prototype.removeCookie=function(e){return r.remove(e)},e.prototype.buildQuery=function(e){if(!(e&&e instanceof Object))return"";var t="?";for(var n in e)e[n]instanceof Object?t+=n+"="+JSON.stringify(e[n])+"&":t+=n+"="+e[n].toString()+"&";return t.slice(0,t.length-1)},e.prototype.getQuery=function(e){for(var t=window.location.search.replace("?","").split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("=");n[o[0]]=o[1]}return n[e]?n[e]:""},e.prototype.isFunction=function(e){return"[object Function]"===this.toString.call(e)},e.prototype.isEqual=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=_typeof(e);return("function"===o||"object"===o||"object"===_typeof(t))&&this.deepIsEqual(e,t,n,r)},e.prototype.deepIsEqual=function(e,t,n,r){var o=this.toString.call(e);if(o!==this.toString.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var i="[object Array]"===o;if(!i){if("object"!==_typeof(e)||"object"!==_typeof(t))return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(this.isFunction(s)&&s instanceof s&&this.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),i){if((u=e.length)!==t.length)return!1;for(;u--;)if(!this.isEqual(e[u],t[u],n,r))return!1}else{var c=Object.keys(e),p=void 0;if(u=c.length,Object.keys(t).length!==u)return!1;for(;u--;)if(p=c[u],!t.hasOwnProperty(p)||!this.isEqual(e[p],t[p],n,r))return!1}return n.pop(),r.pop(),!0},e.prototype.formatInnerHTML=function(e){return e=(e=e.replace(/(\n\s*)/g,"")).replace(/^[^\S\n]+/gm,"")},e.prototype.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(),s=new o,a=function(){function e(e,t,n){this.data=e,this.watcher=t,this.render=n,this.watchData(this.data)}return e.prototype.watchData=function(t){if(t&&"object"===_typeof(t)){var r=this,e=function(e){var n=t[e];r.watchData(n),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return n},set:function(e){var t;s.isEqual(e,n)||(r.watcher&&(t=JSON.parse(JSON.stringify(r.data))),n=e,r.watchData(n),r.watcher&&r.watcher(t),r.render&&r.render())}})};for(var n in t)e(n)}},e}(),u=new o,c=function(){function e(e,t,n){this.data=e,this.key=t,this.watcher=n,this.watchData(this.data,this.key)}return e.prototype.watchData=function(e,t){if(e&&"object"===_typeof(e)&&e[t]){var n=this,r=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){var t;u.isEqual(e,r)||(n.watcher&&("object"===_typeof(r)&&(t=JSON.parse(JSON.stringify(r))),"object"!==_typeof(r)&&"function"!=typeof r&&(t=r)),r=e,n.watcher&&n.watcher(t))}})}},e}(),p=function(e){this.tagName=e.tagName,this.node=e.node,this.parentNode=e.parentNode,this.attributes=e.attributes,this.childNodes=e.childNodes,this.nodeValue=e.nodeValue,this.type=e.type,this.value=e.value,this.repeatData=e.repeatData,this.eventTypes=e.eventTypes,this.key=e.key,this.checked=!1};function l(e){var t,n,r,o,i=[];return e.childNodes&&Array.from(e.childNodes).forEach(function(e){i.push(l(e))}),new p({tagName:e.tagName,node:e,parentNode:e.parentNode,attributes:(n=e,r=n.attributes,o=[],r&&Array.from(r).forEach(function(e){o.push({name:e.name,value:e.value})}),o),childNodes:i,nodeValue:e.nodeValue,type:(t=e,1===t.nodeType?"element":3===t.nodeType?"text":11===t.nodeType?"document-fragment":""),value:e.value,repeatData:e.repeatData?e.repeatData:null,eventTypes:e.eventTypes?e.eventTypes:null,key:e.indiv_repeat_key?e.indiv_repeat_key:null})}function b(o,i,s,a){0<o.childNodes.length&&o.childNodes.forEach(function(t,e){if(!t.checked){var n=i.childNodes.find(function(e){return e.node.isEqualNode(t.node)&&e.key===t.key&&!e.checked||e.tagName===t.tagName&&e.key===t.key&&!e.checked});if(n){var r=i.childNodes.findIndex(function(e){return e===n});r!==e&&s.push({type:1,newIndex:r,oldVnode:t.node,parentNode:o.node}),d(t,n,s,a),n.checked=!0}else s.push({type:0,node:t.node,parentNode:o.node});t.checked=!0}}),0<i.childNodes.length&&i.childNodes.forEach(function(e,t){e.checked||(s.push({type:1,newIndex:t,oldVnode:e.node,parentNode:o.node}),e.checked=!0)})}function d(e,t,n,r){if(!n)throw new Error("patchList can not be null, diffVnode must need an Array");var o,i,s,a,u,c,p,l,d,h,f,v,m,y,$,g;"document-fragment"!==t.type?(o=e,s=n,(i=t).attributes.forEach(function(t){var e=o.attributes.find(function(e){return e.name===t.name});e&&e.value===t.value||s.push({type:2,node:o.node,newValue:t,oldValue:e})}),o.attributes.forEach(function(t){i.attributes.find(function(e){return e.name===t.name})||s.push({type:3,node:o.node,oldValue:t})}),u=t,c=n,(a=e).nodeValue!==u.nodeValue&&c.push({type:4,node:a.node,newValue:u.nodeValue,oldValue:a.nodeValue}),"INPUT"!==e.tagName&&"TEXTAREA textarea"!==e.tagName&&"INPUT"!==e.tagName||(l=t,d=n,(p=e).value!==l.value&&d.push({type:5,node:p.node,newValue:l.value,oldValue:p.value})),h=e,f=t,n.push({type:6,node:h.node,newValue:f.repeatData}),v=e,m=t,y=n,$=JSON.parse(v.eventTypes),(g=JSON.parse(m.eventTypes))&&0<g.length&&g.forEach(function(e){y.push({type:7,node:v.node,eventType:e,newValue:m.node["event"+e]})}),$&&0<$.length&&$.forEach(function(t){(!g||g.length<=0)&&y.push({type:7,node:v.node,eventType:t,newValue:null}),g&&0<g.length&&!g.find(function(e){return e===t})&&y.push({type:7,node:v.node,eventType:t,newValue:null})}),y.push({type:8,node:v.node,newValue:m.eventTypes}),r&&!r(e,t)||b(e,t,n,r)):b(e,t,n,r)}var g=function(){function e(e){this.$fragment=e}return e.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").replace("$.","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},e.prototype._setValueByValue=function(e,t,n,r){var o,i=t.replace("()","").replace("$.","").split("."),s=e;i.forEach(function(e,t){if(e===n&&0===t)return o=e;t<i.length&&(o=e),t<i.length-1&&(s=s[e])}),o&&(s[o]=r)},e.prototype._getVMVal=function(e,t){var n=t.replace("()","").replace("$.","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMRepeatVal=function(n,e,r){var o;return e.replace("()","").replace("$.","").split(".").forEach(function(e,t){o=e!==r||0!==t?o[e]:n}),o},e.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},e.prototype._getVMFunctionArguments=function(e,t,n,r,o){var i=t.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),s=[],a=this;return i.forEach(function(t){return""!==t&&("$element"===t?s.push(n):"true"===t||"false"===t?s.push("true"===t):/(\$\.).*/g.test(t)?s.push(a._getVMVal(e.state,t)):/\'.*\'/g.test(t)?s.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?s.push(Number(t)):0===t.indexOf(r)||0===t.indexOf(r+".")?s.push(a._getVMRepeatVal(o,t,r)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return s.push(a._getValueByValue(n.repeatData[e],t,e))})))}),s},e.prototype.bind=function(e,t,n,r,o,i,s,a){var u,c=e.repeatData[t];if(/^(\@)/.test(r)){if("model"===n)throw new Error("directive: nv-model can't use "+r+" as value");var p=this._getVMFunction(i,r),l=this._getVMFunctionArguments(i,r,e,t,a);u=p.apply(i,l)}else if(0===r.indexOf(t)||0===r.indexOf(t+"."))u=this._getVMRepeatVal(c,r,t);else if(/(\$\.).*/.test(r))u=this._getVMVal(i.state,r);else{if("$index"!==r)throw new Error("directive: nv-"+n+" can't use recognize this value "+r);u=o}e.hasChildNodes()||this.templateUpdater(e,c,t,i);var d=this[n+"Updater"];switch(n){case"model":var h=void 0;h=0===r.indexOf(t)||0===r.indexOf(t+".")?s:this._getVMVal(i.state,r),d&&d.call(this,e,u,r,t,o,h,i);break;case"text":case"html":case"if":case"class":case"key":d&&d.call(this,e,u);break;default:this.commonUpdater.call(this,e,u,n)}},e.prototype.templateUpdater=function(e,t,n,r){var o=e.textContent;if(/\{\{(.*)\}\}/g.test(o)){var i=o.match(/(\{\{[^\{\}]+?\}\})/g);if(i&&0<i.length)for(var s=0;s<i.length;s++){var a=i[s].replace("{{","").replace("}}",""),u=null;if(/^(\@)/.test(a)){var c=this._getVMFunction(r,a),p=this._getVMFunctionArguments(r,a,e,n,t);u=c.apply(r,p)}else if(0===a.indexOf(n)||0===a.indexOf(n+"."))u=this._getVMRepeatVal(t,a,n);else{if(!/(\$\.).*/.test(a))throw new Error("directive: {{"+a+"}} can't use recognize "+a);u=this._getVMVal(r.state,a)}e.textContent=e.textContent.replace(i[s],u)}}},e.prototype.modelUpdater=function(e,t,r,o,i,s,a){e.value=void 0===t?"":t;var u=this,n=function(e){if(e.preventDefault(),/(\$\.).*/.test(r)){var t=r.replace("$.","");if(e.target.value===s)return;a.state[t]=e.target.value}else{if(0!==r.indexOf(o)&&0!==r.indexOf(o+"."))throw new Error("directive: nv-model can't use recognize this value");if("object"!==_typeof(s[i])&&(s[i]=e.target.value),"object"===_typeof(s[i])){var n=u._getValueByValue(s[i],r,o);n=e.target.value,u._setValueByValue(s[i],r,o,n)}}};if(e.oninput=n,e.eventinput=n,e.eventTypes){var c=JSON.parse(e.eventTypes);c.push("input"),e.eventTypes=JSON.stringify(c)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},e.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},e.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},e.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},e.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},e.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},e.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},e.prototype.eventHandler=function(o,i,e,t,s,a){var n=t.split(":")[1],u=this._getVMFunction(i,e),c=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/ /g,"").split(","),p=this,r=function(e){var n=this,r=[];c.forEach(function(t){return""!==t&&("$event"===t?r.push(e):"$element"===t?r.push(o):"true"===t||"false"===t?r.push("true"===t):/(\$\.).*/g.test(t)?r.push(p._getVMVal(i.state,t)):/\'.*\'/g.test(t)?r.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?r.push(Number(t)):0===t.indexOf(s)||0===t.indexOf(s+".")?r.push(p._getVMRepeatVal(a,t,s)):void(n.repeatData&&Object.keys(n.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return r.push(p._getValueByValue(n.repeatData[e],t,e))})))}),u.apply(i,r)};if(n&&u){if(o["on"+n]=r,o["event"+n]=r,o.eventTypes){var l=JSON.parse(o.eventTypes);l.push(n),o.eventTypes=JSON.stringify(l)}o.eventTypes||(o.eventTypes=JSON.stringify([n]))}},e}(),h=function(){function f(e){this.$fragment=e}return f.prototype._getValueByValue=function(e,t,n){var r=t.replace("()","").replace("$.","").split("."),o=e;return r.forEach(function(e,t){e===n&&0===t||(o=o[e])}),o},f.prototype._getVMVal=function(e,t){var n=t.replace("()","").replace("$.","").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},f.prototype._getVMRepeatVal=function(e,t){var n=t.split(" ");return this._getVMVal(e.state,n[3])},f.prototype._getVMFunction=function(e,t){var n=t.replace(/^(\@)/,"").replace(/\(.*\)/,"").split("."),r=e;return n.forEach(function(e){r=r[e]}),r},f.prototype._getVMFunctionArguments=function(t,e,n){var r=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),o=[];return r.forEach(function(e){return""!==e&&("$element"===e?o.push(n):"true"===e||"false"===e?o.push("true"===e):/(\$\.).*/g.test(e)?o.push((new f)._getVMVal(t.state,e)):/\'.*\'/g.test(e)?o.push(e.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(e)&&/^[0-9]*$/g.test(e)?o.push(Number(e)):void 0)}),o},f.prototype.bind=function(e,t,n,r){var o=this[r+"Updater"];if(this.isRepeatNode(e))switch(r){case"repeat":o&&o.call(this,e,this._getVMRepeatVal(t,n),n,t)}else{var i=null;if(/^(\@)/.test(n)){if("model"===r)throw new Error("directive: nv-model can't use "+n+" as value");var s=this._getVMFunction(t,n),a=this._getVMFunctionArguments(t,n,e);i=s.apply(t,a)}else{if(!/(\$\.).*/.test(n))throw new Error("directive: nv-"+r+" can't use recognize this value "+n);i=this._getVMVal(t.state,n)}switch(r){case"model":o&&o.call(this,e,i,n,t);break;case"text":case"html":case"if":case"class":case"key":o&&o.call(this,e,i);break;default:this.commonUpdater.call(this,e,i,r)}e.removeAttribute("nv-"+r)}},f.prototype.templateUpdater=function(e,t,n){var r=n.replace("{{","").replace("}}",""),o=null;if(/^(\@)/.test(r)){var i=this._getVMFunction(t,r),s=this._getVMFunctionArguments(t,r,e);o=i.apply(t,s)}else{if(!/(\$\.).*/.test(r))throw new Error("directive: "+n+" can't use recognize this value");o=this._getVMVal(t.state,r)}e.textContent=e.textContent.replace(n,o)},f.prototype.modelUpdater=function(e,t,n,r){e.value=void 0===t?"":t;var o=n.replace("$.",""),i=function(e){e.preventDefault(),/(\$\.).*/.test(n)&&(r.state[o]=e.target.value)};if(e.oninput=i,e.eventinput=i,e.eventTypes){var s=JSON.parse(e.eventTypes);s.push("input"),e.eventTypes=JSON.stringify(s)}e.eventTypes||(e.eventTypes=JSON.stringify(["input"]))},f.prototype.textUpdater=function(e,t){if("input"===e.tagName.toLocaleLowerCase())return e.value=t;e.textContent=void 0===t?"":t},f.prototype.htmlUpdater=function(e,t){e.innerHTML=void 0===t?"":t},f.prototype.ifUpdater=function(e,t){!t&&this.$fragment.contains(e)&&this.$fragment.removeChild(e)},f.prototype.classUpdater=function(e,t){if(t){var n=e.className,r=(n=n.replace(/\s$/,""))&&String(t)?" ":"";e.className=n+r+t}},f.prototype.keyUpdater=function(e,t){e.indiv_repeat_key=t},f.prototype.commonUpdater=function(e,t,n){t&&(e[n]=t),!t&&e[n]&&(e[n]=null)},f.prototype.repeatUpdater=function(r,a,u,c){var p=this;if(a){if(a&&!(a instanceof Array))throw new Error("compile error: nv-repeat need an Array!");var l=u.split(" ")[1];a.forEach(function(o,i){var e={};e[l]=o,e.$index=i;var s=p.cloneNode(r,e),t=s.attributes,n=s.textContent;p.$fragment.insertBefore(s,r),s.removeAttribute("nv-repeat"),p.isTextNode(s)&&/\{\{(.*)\}\}/g.test(n)&&new g(p.$fragment).templateUpdater(s,o,l,c),t&&Array.from(t).forEach(function(e){var t=e.name;if(p.isDirective(t)&&"nv-repeat"!==t){var n=t.substring(3),r=e.value;p.isEventDirective(n)?new g(p.$fragment).eventHandler(s,c,r,n,l,o):new g(p.$fragment).bind(s,l,n,r,i,c,a,o),s.removeAttribute(t)}}),s.hasChildNodes()&&p.$fragment.contains(s)&&p.repeatChildrenUpdater(s,o,u,i,c,a)})}},f.prototype.repeatChildrenUpdater=function(s,a,u,c,p,l){var d=this,h=u.split(" ")[1];Array.from(s.childNodes).forEach(function(o){d.isElementNode(o)&&p.$components.find(function(e){return e.$selector===o.tagName.toLocaleLowerCase()})&&(o.isComponent=!0),o.repeatData=s.repeatData||{},o.repeatData[h]=a,o.repeatData.$index=c,d.isRepeatProp(o)&&o.setAttribute("_prop-"+h,JSON.stringify(a));var e=o.attributes,t=o.textContent;d.isTextNode(o)&&/\{\{(.*)\}\}/g.test(t)&&new g(s).templateUpdater(o,a,h,p),e&&Array.from(e).forEach(function(e){var t=e.name,n=e.value,r=t.substring(3);d.isDirective(t)&&"nv-repeat"!==t&&new RegExp("(^"+h+")|(^$.)|(^@)").test(n)&&(d.isEventDirective(r)?new g(s).eventHandler(o,p,n,r,h,a):new g(s).bind(o,h,r,n,c,p,l,a),o.removeAttribute(t))}),o.hasChildNodes()&&!d.isRepeatNode(o)&&s.contains(o)&&d.repeatChildrenUpdater(o,a,u,c,p,l);var n=o.attributes;if(n&&s.contains(o)){var r=Array.from(n).find(function(e){return d.isDirective(e.name)&&"nv-repeat"===e.name});if(r){var i=r.value.split(" ")[3];/^(\$\.)/.test(i)&&(new f(s).bind(o,p,r.value,r.name.substring(3)),s.contains(o)&&s.removeChild(o)),new RegExp("(^"+h+")").test(i)&&(new f(s).repeatUpdater(o,d._getValueByValue(a,i,h),r.value,p),s.contains(o)&&s.removeChild(o)),s.removeAttribute("nv-repeat")}}})},f.prototype.eventHandler=function(r,o,e,t){var n=t.split(":")[1],i=this._getVMFunction(o,e),s=e.replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),a=function(t){var n=[];s.forEach(function(e){return""!==e&&("$event"===e?n.push(t):"$element"===e?n.push(r):"true"===e||"false"===e?n.push("true"===e):/(\$\.).*/g.test(e)?n.push((new f)._getVMVal(o.state,e)):/\'.*\'/g.test(e)?n.push(e.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(e)&&/^[0-9]*$/g.test(e)?n.push(Number(e)):void 0)}),i.apply(o,n)};if(n&&i){if(r["on"+n]=a,r["event"+n]=a,r.eventTypes){var u=JSON.parse(r.eventTypes);u.push(n),r.eventTypes=JSON.stringify(u)}r.eventTypes||(r.eventTypes=JSON.stringify([n]))}},f.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},f.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},f.prototype.isElementNode=function(e){return 1===e.nodeType},f.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},f.prototype.isRepeatProp=function(e){var t=e.attributes;return!!t&&!!Array.from(t).find(function(e){return/^\{(.+)\}$/.test(e.value)})},f.prototype.isTextNode=function(e){return 3===e.nodeType},f.prototype.cloneNode=function(t,e){var n=t.cloneNode(!0);return t.eventTypes&&(JSON.parse(t.eventTypes).forEach(function(e){n["on"+e]=t["event"+e],n["event"+e]=t["event"+e]}),n.eventTypes=t.eventTypes),e&&(n.repeatData=e),t.isComponent&&(n.isComponent=!0),n},f}(),f=new o,v=function(){function e(e,t){if(this.$vm=t,this.$el=this.isElementNode(e)?e:document.querySelector(e),this.$el){this.$fragment=this.node2Fragment(),this.init();var n=l(this.$el),r=l(this.$fragment),o=[];d(n,r,o,this.needDiffChildCallback.bind(this)),(i=o).sort(function(e,t){return e.type===t.type&&e.newIndex&&t.newIndex?e.newIndex-t.newIndex:e.type-t.type}),i.forEach(function(e){switch(e.type){case 0:e.parentNode.removeChild(e.node);break;case 1:Array.from(e.parentNode.children).indexOf(e.oldVnode)!==e.newIndex&&(e.parentNode.contains(e.oldVnode)&&e.parentNode.removeChild(e.oldVnode),e.parentNode.childNodes[e.newIndex]?e.parentNode.insertBefore(e.oldVnode,e.parentNode.childNodes[e.newIndex]):e.parentNode.appendChild(e.oldVnode));break;case 2:e.node.setAttribute(e.newValue.name,e.newValue.value);break;case 3:e.node.removeAttribute(e.oldValue.name);break;case 4:e.node.nodeValue=e.newValue;break;case 5:e.node.value=e.newValue;break;case 6:e.node.repeatData=e.newValue;break;case 7:e.node["on"+e.eventType]=e.newValue;break;case 8:e.node.eventTypes=e.newValue}}),o=r=n=this.$fragment=null}var i}return e.prototype.needDiffChildCallback=function(e,t){return t.node.isComponent&&e.node?!(e.node.isComponent=!0):e.tagName!==t.tagName||t.tagName!==this.$vm.$vm.$routeDOMKey.toLocaleUpperCase()},e.prototype.init=function(){this.compileElement(this.$fragment)},e.prototype.compileElement=function(e){var t=document.createElement("div");t.innerHTML=f.formatInnerHTML(this.$vm.$template);var n=t.childNodes;this.recursiveDOM(n,e)},e.prototype.recursiveDOM=function(e,i){var s=this;Array.from(e).forEach(function(t){s.isElementNode(t)&&s.$vm.$components.find(function(e){return e.$selector===t.tagName.toLocaleLowerCase()})&&(t.isComponent=!0),t.hasChildNodes()&&!s.isRepeatNode(t)&&s.recursiveDOM(t.childNodes,t),i.appendChild(t);var e=t.textContent;if(s.isElementNode(t)&&s.compile(t,i),s.isTextNode(t)&&/\{\{(.*)\}\}/g.test(e)){var n=e.match(/(\{\{[^\{\}]+?\}\})/g),r=n.length;if(n&&0<r)for(var o=0;o<r;o++)s.compileText(t,n[o])}s.isRepeatNode(t)&&i.contains(t)&&i.removeChild(t)})},e.prototype.compile=function(i,s){var a=this,e=i.attributes;e&&Array.from(e).forEach(function(e){var t=e.name;if(a.isDirective(t)){var n=t.substring(3),r=e.value,o=new h(s);a.isEventDirective(n)?(o.eventHandler(i,a.$vm,r,n),i.removeAttribute(t)):o.bind(i,a.$vm,r,n)}})},e.prototype.node2Fragment=function(){return document.createDocumentFragment()},e.prototype.compileText=function(e,t){new h(this.$fragment).templateUpdater(e,this.$vm,t)},e.prototype.isDirective=function(e){return 0===e.indexOf("nv-")},e.prototype.isEventDirective=function(e){return 0===e.indexOf("on")},e.prototype.isElementNode=function(e){return"string"!=typeof e&&1===e.nodeType},e.prototype.isRepeatNode=function(e){var t=e.attributes,n=!1;return t&&Array.from(t).forEach(function(e){"nv-repeat"===e.name&&(n=!0)}),n},e.prototype.isTextNode=function(e){return 3===e.nodeType},e}();function m(i,s,a,u){return new(a||(a=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}o((u=u.apply(i,s||[])).next())})}function y(n,r){var o,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function $(t){return function(e){e.isSingletonMode=!0,t&&(e.isSingletonMode=t.isSingletonMode)}}function w(s,a){var u=[];return s._needInjectedClass&&s._needInjectedClass.forEach(function(t){if(s.prototype.$providerList){var e=s.prototype.$providerList.get(t);if(e&&!e.useClass&&!e.useValue)return u.push(C(e,a));if(e&&e.useClass)return u.push(C(e.useClass,a));if(e&&e.useValue)return u.push(e.useValue)}var n=s._injectedProviders.has(t)?s._injectedProviders.get(t):a.$providers.find(function(e){return!e.provide&&e===t||!(!e.provide||e.provide!==t)}),r=null;if(!n||n.useClass||n.useValue||(r=n),n&&n.useClass&&(r=n.useClass),n&&n.useValue)return u.push(n.useValue);if(!r)throw new Error("injector injects service error: can't find provide: "+t.name+" in Component "+s);if(r&&!r.isSingletonMode&&u.push(C(r,a)),r&&r.isSingletonMode){var o=a.$providerInstances.has(t)?a.$providerInstances.get(t):null;if(o&&u.push(o),!o){var i=C(r,a);a.$providerInstances.set(t,i),u.push(i)}}}),s.injectTokens&&s.injectTokens.forEach(function(t){if(s.prototype.$providerList){var e=s.prototype.$providerList.get(t);if(e&&!e.useClass&&!e.useValue)throw new Error("injector injects service error: can't find provide: "+t+" in Component "+s);if(e&&e.useClass)return u.push(C(e.useClass,a));if(e&&e.useValue)return u.push(e.useValue)}var n=s._injectedProviders.has(t)?s._injectedProviders.get(t):a.$providers.find(function(e){return!(!e.provide||e.provide!==t)}),r=null;if(n&&!n.useClass&&!n.useValue)throw new Error("injector injects service error: can't find provide: "+t+" in Component "+s);if(n&&n.useClass&&(r=n.useClass),n&&n.useValue)return u.push(n.useValue);if(!r)throw new Error("injector injects service error: can't find provide: "+t+" in Component "+s);if(r&&!r.isSingletonMode&&u.push(C(r,a)),r&&r.isSingletonMode){var o=a.$providerInstances.has(t)?a.$providerInstances.get(t):null;if(o&&u.push(o),!o){var i=C(r,a);a.$providerInstances.set(t,i),u.push(i)}}}),u}function C(e,t){var n=w(e,t);return Reflect.construct(e,n)}function _(e){return function(e){if(e.$providers)for(var t=e.$providers.length,n=0;n<t;n++){var r=e.$providers[n];r.provide?(r.useClass||r.useValue)&&e.$providerList.set(r.provide,r):e.$providerList.set(r,r)}}(e.prototype),function(t){if(t.$providers)for(var e=t.$providers.length,n=function(e){var n=t.$providers[e];n.provide?n.useClass&&(n.useClass._injectedProviders||(n.useClass._injectedProviders=new Map),t.$providerList.forEach(function(e,t){n.useClass._injectedProviders.has(t)||n.useClass._injectedProviders.set(t,e)})):(n._injectedProviders||(n._injectedProviders=new Map),t.$providerList.set(n,n))},r=0;r<e;r++)n(r)}(e.prototype),function(n){if(n.$components)for(var e=n.$components.length,t=function(e){var t=n.$components[e];t._injectedComponents||(t._injectedComponents=new Map),n.$components.forEach(function(e){t._injectedComponents.has(e.$selector)||t._injectedComponents.set(e.$selector,e)})},r=0;r<e;r++)t(r)}(e.prototype),function(t){if(t.$providers&&t.$components)for(var e=t.$components.length,n=function(e){var n=t.$components[e];n._injectedProviders||(n._injectedProviders=new Map),t.$providerList.forEach(function(e,t){n._injectedProviders.has(t)||n._injectedProviders.set(t,e)})},r=0;r<e;r++)n(r)}(e.prototype),function(n){if(n.$imports)for(var e=n.$imports.length,t=0;t<e;t++)for(var r=_(n.$imports[t]),o=r.$exportsList.length,i=function(e){var t=r.$exportsList[e];n.$components.find(function(e){return e.$selector===t.$selector})||n.$components.push(t)},s=0;s<o;s++)i(s)}(e.prototype),function(s){if(s.$exports)for(var e=s.$exports.length,t=function(e){var t=s.$exports[e];if("nvModule"===t.nvType)for(var n=_(t),r=n.$exportsList.length,o=function(e){var t=n.$exportsList[e];s.$exportsList.find(function(e){return e.$selector===t.$selector})||s.$exportsList.push(t)},i=0;i<r;i++)o(i);"nvModule"!==t.nvType&&(s.$exportsList.find(function(e){return e.$selector===t.$selector})||s.$exportsList.push(t))},n=0;n<e;n++)t(n)}(e.prototype),C(e,e.prototype)}var R=new o,V=function(){function e(){this.routes=[],this.routesList=[],this.currentUrl="",this.lastRoute=null,this.rootDom=null,this.$rootPath="/",this.hasRenderComponentList=[],this.needRedirectPath=null,this.$vm=null,this.watcher=null,this.renderRouteList=[]}return e.prototype.bootstrap=function(e){var t=this;this.$vm=e,this.$vm.setRootPath(this.$rootPath),this.$vm.$canRenderModule=!1,this.$vm.$routeDOMKey="router-render",R.isBrowser()&&(window.addEventListener("load",this.refresh.bind(this),!1),window.addEventListener("popstate",function(){var e;e="/"===t.$rootPath?location.pathname||"/":""===location.pathname.replace(t.$rootPath,"")?"/":location.pathname.replace(t.$rootPath,""),t.$vm.$esRouteObject={path:e,query:{},data:null},t.$vm.$esRouteParmasObject={}},!1))},e.prototype.init=function(e){if(R.isBrowser()){if(!(e&&e instanceof Array))throw new Error("route error: no routes exit");var t=document.querySelector("#root");this.rootDom=t||null,this.routes=e,this.routesList=[]}},e.prototype.setRootPath=function(e){if(!e||"string"!=typeof e)throw new Error("route error: rootPath is not defined or rootPath must be a String");this.$rootPath=e},e.prototype.redirectTo=function(e){var t="/"===this.$rootPath?"":this.$rootPath;history.replaceState(null,null,""+t+e),this.$vm.$esRouteObject={path:e||"/",query:{},data:null},this.$vm.$esRouteParmasObject={}},e.prototype.refresh=function(){if(!this.$vm.$esRouteObject||!this.watcher){var e=void 0;e="/"===this.$rootPath?location.pathname||"/":""===location.pathname.replace(this.$rootPath,"")?"/":location.pathname.replace(this.$rootPath,""),this.$vm.$esRouteObject={path:e,query:{},data:null},this.$vm.$esRouteParmasObject={},this.watcher=new c(this.$vm,"$esRouteObject",this.refresh.bind(this))}this.currentUrl=this.$vm.$esRouteObject.path||"/",this.routesList=[],this.renderRouteList="/"===this.currentUrl?["/"]:this.currentUrl.split("/"),this.renderRouteList[0]="/",this.distributeRoutes()},e.prototype.distributeRoutes=function(){return m(this,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return this.lastRoute&&this.lastRoute!==this.currentUrl?(this.$vm.$esRouteParmasObject={},[4,this.insertRenderRoutes()]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.generalDistributeRoutes()];case 3:e.sent(),e.label=4;case 4:return this.routeChange&&this.routeChange(this.lastRoute,this.currentUrl),this.lastRoute=this.currentUrl,this.needRedirectPath&&(this.redirectTo(this.needRedirectPath),this.needRedirectPath=null),[2]}})})},e.prototype.insertRenderRoutes=function(){return m(this,void 0,void 0,function(){var h,t,f,n,r;return y(this,function(e){switch(e.label){case 0:(h="/"===this.lastRoute?["/"]:this.lastRoute.split("/"))[0]="/",t=function(t){var n,r,o,i,s,a,u,c,p,l,d;return y(this,function(e){switch(e.label){case 0:if(n=f.renderRouteList[t],0===t){if(!(r=f.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+f.currentUrl);f.routesList.push(r)}else{if(!((o=f.routesList[t-1].children)&&o instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(i=o.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+f.currentUrl);f.routesList.push(i)}if(n===h[t])return[3,6];if(!(s=f.routesList[t]))throw new Error("route error: wrong route instantiation in insertRenderRoutes: "+f.currentUrl);if(l=document.querySelectorAll("router-render")[t-1],!s.component&&!s.redirectTo&&!s.loadChild)throw new Error("route error: path "+s.path+" need a component which has children path or need a redirectTo which has't children path");return/^\/\:.+/.test(s.path)&&!s.redirectTo&&(p=s.path.split("/:")[1],f.$vm.$esRouteParmasObject[p]=n),u=a=null,s.component?(a=f.$vm.$components.find(function(e){return e.$selector===s.component}),[4,f.instantiateComponent(a,l)]):[3,2];case 1:u=e.sent(),e.label=2;case 2:return s.loadChild?[4,f.NvModuleFactoryLoader(s.loadChild)]:[3,5];case 3:return c=e.sent(),a=c.$bootstrap,[4,f.instantiateComponent(a,l,c)];case 4:u=e.sent(),e.label=5;case 5:if(a){if(!u)throw new Error("route error: path "+s.path+" need a component");f.hasRenderComponentList[t]&&f.hasRenderComponentList.splice(t,0,u),f.hasRenderComponentList[t]||(f.hasRenderComponentList[t]=u),f.routerChangeEvent(t)}if(s.redirectTo&&/^\/.*/.test(s.redirectTo)&&t+1===f.renderRouteList.length)return f.needRedirectPath=s.redirectTo,[2,{value:void 0}];e.label=6;case 6:return n===h[t]&&(d=f.routesList[t],/^\/\:.+/.test(d.path)&&!d.redirectTo&&(p=d.path.split("/:")[1],f.$vm.$esRouteParmasObject[p]=n)),t===f.renderRouteList.length-1&&t<h.length-1&&(l=document.querySelectorAll("router-render")[t],f.routerChangeEvent(t),l&&l.hasChildNodes()&&l.removeChild(l.childNodes[0]),(d=f.routesList[t]).redirectTo&&/^\/.*/.test(d.redirectTo)&&t+1===f.renderRouteList.length)?(f.needRedirectPath=d.redirectTo,[2,{value:void 0}]):[2]}})},f=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.generalDistributeRoutes=function(){return m(this,void 0,void 0,function(){var t,d,n,r;return y(this,function(e){switch(e.label){case 0:t=function(t){var n,r,o,i,s,a,u,c,p,l;return y(this,function(e){switch(e.label){case 0:if(n=d.renderRouteList[t],0!==t)return[3,6];if(!(r=d.routes.find(function(e){return e.path===""+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation in generalDistributeRoutes: "+d.currentUrl);return o=document.querySelector("#root"),c=u=null,r.component?(u=d.$vm.$rootModule.$components.find(function(e){return e.$selector===r.component}),[4,d.instantiateComponent(u,o)]):[3,2];case 1:c=e.sent(),e.label=2;case 2:return r.loadChild?[4,d.NvModuleFactoryLoader(r.loadChild)]:[3,5];case 3:return p=e.sent(),u=p.$bootstrap,[4,d.instantiateComponent(u,o,p)];case 4:c=e.sent(),e.label=5;case 5:if(!u)throw new Error("route error: root route's path: "+r.path+" need a component");return/^\/\:.+/.test(r.path)&&(l=r.path.split("/:")[1],d.$vm.$esRouteParmasObject[l]=n),R.isBrowser()?(d.routesList.push(r),c&&d.hasRenderComponentList.push(c),t===d.renderRouteList.length-1&&d.routerChangeEvent(t),r.redirectTo&&/^\/.*/.test(r.redirectTo)&&t+1===d.renderRouteList.length?(d.needRedirectPath=r.redirectTo,d.renderRouteList.push(r.redirectTo),[2,{value:void 0}]):[3,12]):[2,{value:void 0}];case 6:if(!((i=d.routesList[t-1].children)&&i instanceof Array))throw new Error("route error: routes not exit or routes must be an array!");if(!(s=i.find(function(e){return e.path==="/"+n||/^\/\:.+/.test(e.path)})))throw new Error("route error: wrong route instantiation: "+d.currentUrl);return a=document.querySelectorAll("router-render")[t-1],c=u=null,s.component?(u=d.$vm.$rootModule.$components.find(function(e){return e.$selector===s.component}),[4,d.instantiateComponent(u,a)]):[3,8];case 7:c=e.sent(),e.label=8;case 8:return s.loadChild?[4,d.NvModuleFactoryLoader(s.loadChild)]:[3,11];case 9:return p=e.sent(),u=p.$bootstrap,[4,d.instantiateComponent(u,a,p)];case 10:c=e.sent(),e.label=11;case 11:if(!s.component&&!s.redirectTo&&!s.loadChild)throw new Error("route error: path "+s.path+" need a component which has children path or need a  redirectTo which has't children path");if(/^\/\:.+/.test(s.path)&&(l=s.path.split("/:")[1],d.$vm.$esRouteParmasObject[l]=n),d.routesList.push(s),c&&d.hasRenderComponentList.push(c),t===d.renderRouteList.length-1&&d.routerChangeEvent(t),s.redirectTo&&/^\/.*/.test(s.redirectTo)&&t+1===d.renderRouteList.length)return d.needRedirectPath=s.redirectTo,[2,{value:void 0}];e.label=12;case 12:return[2]}})},d=this,n=0,e.label=1;case 1:return n<this.renderRouteList.length?[5,t(n)]:[3,4];case 2:if("object"===_typeof(r=e.sent()))return[2,r.value];e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.routerChangeEvent=function(n){var r=this;this.hasRenderComponentList.forEach(function(e,t){e.nvRouteChange&&e.nvRouteChange(r.lastRoute,r.currentUrl),r.emitComponentEvent(e.$componentList,"nvRouteChange"),n+1<=t&&(e.nvOnDestory&&e.nvOnDestory(),r.emitComponentEvent(e.$componentList,"nvOnDestory"))}),this.hasRenderComponentList.length=n+1},e.prototype.emitComponentEvent=function(e,t){var n=this;"nvRouteChange"===t&&e.forEach(function(e){e.scope.nvRouteChange&&e.scope.nvRouteChange(n.lastRoute,n.currentUrl),n.emitComponentEvent(e.scope.$componentList,t)}),"nvOnDestory"===t&&e.forEach(function(e){e.scope.nvOnDestory&&e.scope.nvOnDestory(),n.emitComponentEvent(e.scope.$componentList,t)})},e.prototype.instantiateComponent=function(e,t,n){return this.$vm.renderComponent(e,t,n)},e.prototype.NvModuleFactoryLoader=function(n){return m(this,void 0,void 0,function(){var t;return y(this,function(e){switch(e.label){case 0:return t=null,n instanceof Function&&!n.child?[4,n()]:[3,2];case 1:t=e.sent().default,e.label=2;case 2:return n instanceof Object&&n.child?[4,n.child()]:[3,4];case 3:t=e.sent()[n.name],e.label=4;case 4:if(!t)throw new Error("load child failed, please check your routes.");return[2,_(t)]}})})},e}();var E=new o;function x(e,t){return E.isFunction(e)?e.bind(t):e}var N=new o;function j(e,c){var p=c.$componentList.slice();!function(r,$){$.$componentList=[];var o=r.querySelectorAll($.$vm.$routeDOMKey)[0];$.constructor._injectedComponents.forEach(function(e,t){$.$components.find(function(e){return e.$selector===t})||$.$components.push(e)});for(var e=$.$components.length,t=function(n){var e=$.$components[n].$selector,t=r.getElementsByTagName(e);Array.from(t).forEach(function(v){if((!o||!o.contains(v))&&v.isComponent){var e=v.attributes,m={};if(e){var t=Array.from(e),y={};t.forEach(function(e){/^\_prop\-(.+)/.test(e.name)&&(y[e.name.replace("_prop-","")]=JSON.parse(e.value),v.removeAttribute(e.name))}),t.forEach(function(e){var n=e.name;if(!/^\_prop\-(.+)/.test(n)){var t=n.split("-");1<t.length&&t.forEach(function(e,t){0===t&&(n=e),0!==t&&(n+=e.toLowerCase().replace(/( |^)[a-z]/g,function(e){return e.toUpperCase()}))});var r,o,i,s=/^\{(.+)\}$/.exec(e.value);if(s){var a=s[1].split("."),u=a[0],c=null;if(/^(\$\.).*/g.test(s[1]))return c=$.compileUtil._getVMVal($.state,s[1]),void(m[n]=x(c,$));if(/^(\@.).*\(.*\)$/g.test(s[1])){var p=new g,l=p._getVMFunction($,s[1]),d=s[1].replace(/^(\@)/,"").match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","),h=[];d.forEach(function(t){return""!==t&&("$element"===t?h.push(v):"true"===t||"false"===t?h.push("true"===t):/(\$\.).*/g.test(t)?h.push(p._getVMVal($.state,t)):/\'.*\'/g.test(t)?h.push(t.match(/\'(.*)\'/)[1]):!/\'.*\'/g.test(t)&&/^[0-9]*$/g.test(t)?h.push(Number(t)):void(v.repeatData&&Object.keys(v.repeatData).forEach(function(e){if(0===t.indexOf(e)||0===t.indexOf(e+"."))return h.push(p._getValueByValue(v.repeatData[e],t,e))})))});var f=l.apply($,h);return void(m[n]=f)}if(/^(\@.).*[^\(.*\)]$/g.test(s[1]))return c=$.compileUtil._getVMVal($,s[1].replace(/^(\@)/,"")),void(m[n]=x(c,$));if(y.hasOwnProperty(u))return r=a,o=y[u],i=o,r.forEach(function(e,t){0!==t&&(i=i[e])}),c=i,void(m[n]=x(c,$));if(v.repeatData&&null!==v.repeatData[u])return c=$.compileUtil._getValueByValue(v.repeatData[u],s[1],u),void(m[n]=x(c,$))}"indiv_repeat_key"!==e.name&&v.removeAttribute(n)}})}$.$componentList.push({dom:v,props:m,scope:null,constructorFunction:$.$components[n],hasRender:!1}),v.isComponent=!1}})},n=0;n<e;n++)t(n)}(e,c);for(var t=c.$componentList.length,n=function(e){var t,n,r,o,i,s=c.$componentList[e],a=p.findIndex(function(e){return e.dom===s.dom}),u=p[a];-1!==a&&p.splice(a,1),u?(s.scope=u.scope,N.isEqual(s.scope.props,s.props)||(s.scope.nvReceiveProps&&s.scope.nvReceiveProps(s.props),s.scope.props=s.props),s.hasRender=!0):s.scope=(t=s.constructorFunction,n=s.props,r=s.dom,(i=C(t,(o=c).$vm.$rootModule)).props=n,i.renderDom=r,i.$components=o.$components,i.render=o.$vm.render.bind(i),i.reRender=o.$vm.reRender.bind(i),i),s.scope.$vm=c.$vm,s.scope.$components=c.$components,s.scope.nvOnInit&&!u&&s.scope.nvOnInit(),s.scope.watchData&&s.scope.watchData(),s.scope.nvBeforeMount&&s.scope.nvBeforeMount()},r=0;r<t;r++)n(r);var o=p.length;for(r=0;r<o;r++){var i=p[r];i.scope.nvOnDestory&&i.scope.nvOnDestory()}}var O="pending",M=function(){function e(e){this.$vm=e,this.resetStatus()}return e.prototype.push=function(e){if(this.taskQueue.push(e),this.renderStatus===O)return this.renderStatus="rendering",this.runTask()},e.prototype.stopTask=function(){this.renderStatus=O},e.prototype.runTask=function(){return m(this,void 0,void 0,function(){var t;return y(this,function(e){switch(e.label){case 0:return[4,function(r,o){return m(this,void 0,void 0,function(){return y(this,function(e){return[2,Promise.resolve().then(function(){new v(r,o.$vm),j(r,o.$vm);for(var e=o.$vm.$componentList.length,t=0;t<e;t++){var n=o.$vm.$componentList[t];n.hasRender?n.scope.reRender():(n.scope.render(),n.hasRender=!0),n.scope.nvAfterMount&&n.scope.nvAfterMount()}return o.$vm.nvHasRender&&o.$vm.nvHasRender(),o.$vm}).catch(function(e){throw new Error("component "+o.$vm.constructor.$selector+" render failed: "+e)})]})})}(this.taskQueue[this.queuePointer],this)];case 1:return t=e.sent(),this.nextTask(),[2,t]}})})},e.prototype.nextTask=function(){return m(this,void 0,void 0,function(){return y(this,function(e){return this.taskQueue.length!==this.queuePointer+1?(this.queuePointer++,this.renderStatus===O?[2]:[2,this.runTask()]):(this.resetStatus(),[2])})})},e.prototype.resetStatus=function(){this.renderStatus=O,this.queuePointer=0,this.taskQueue?this.taskQueue.length=0:this.taskQueue=[]},e}();function L(){this.compileUtil=new h;var e=this.renderDom;return this.renderTaskQueue||(this.renderTaskQueue=new M(this)),this.renderTaskQueue.push(e)}var T=new o;var D=new o,S=function(){function e(){this.modalList=[],D.isBrowser()&&(this.rootDom=document.querySelector("#root"),this.$rootPath="/",this.$canRenderModule=!0,this.$routeDOMKey="router-render",this.$rootModule=null,this.$esRouteObject=null,this.$esRouteParmasObject={},this.render=L,this.reRender=L)}return e.prototype.use=function(t){return t.bootstrap(this),this.modalList.push(t),this.modalList.findIndex(function(e){return D.isEqual(e,t)})},e.prototype.setRootPath=function(e){if(!e||"string"!=typeof e)throw new Error("rootPath is not defined or rootPath must be a String");this.$rootPath=e},e.prototype.setComponentRender=function(e,t){this.render=e,this.reRender=t},e.prototype.bootstrapModule=function(e){if(!e)throw new Error("must send a root module");this.$rootModule=_(e),this.$components=this.$rootModule.$components.slice()},e.prototype.init=function(){if(D.isBrowser()){if(!this.$rootModule)throw new Error("must use bootstrapModule to declare a root NvModule before init");this.$canRenderModule&&this.renderModuleBootstrap()}},e.prototype.renderModuleBootstrap=function(){if(!this.$rootModule.$bootstrap)throw new Error("need bootstrap for render Module Bootstrap");var e=this.$rootModule.$bootstrap;this.renderComponent(e,this.rootDom)},e.prototype.renderComponent=function(e,t,n){void 0===n&&(n=this.$rootModule);var r=C(e,n);if(r.$vm=this,r.$components=n.$components,r.render=this.render.bind(r),r.reRender=this.reRender.bind(r),r.nvOnInit&&r.nvOnInit(),r.watchData&&r.watchData(),!r.$template)throw new Error("must decaler this.$template in bootstrap()");var o=r.$template;if(o&&"string"==typeof o&&t)return r.nvBeforeMount&&r.nvBeforeMount(),this.replaceDom(r,t).then(function(e){return e.nvAfterMount&&e.nvAfterMount(),e});throw new Error("renderBootstrap failed: template or rootDom is not exit")},e.prototype.replaceDom=function(e,t){return e.renderDom=t,e.render()},e}(),P=function(){function e(){}return e.prototype.get=function(r,o){return new Promise(function(t,n){var e=o?{params:o}:null;i.get(r,e).then(function(e){t(e.data)}).catch(function(e){n(e.response.data)})})},e.prototype.delete=function(r,o){return new Promise(function(t,n){var e=o?{params:o}:null;i.delete(r,e).then(function(e){t(e.data)}).catch(function(e){n(e.response.data)})})},e.prototype.post=function(e,r){return new Promise(function(t,n){i.post(e,r).then(function(e){t(e.data)}).catch(function(e){n(e.response.data)})})},e.prototype.put=function(e,r){return new Promise(function(t,n){i.put(e,r).then(function(e){t(e.data)}).catch(function(e){n(e.response.data)})})},e.prototype.patch=function(e,r){return new Promise(function(t,n){i.patch(e,r).then(function(e){t(e.data)}).catch(function(e){n(e.response.data)})})},e}(),k=function(){function e(){}return e.prototype.createRequest=function(e,t){var n=Object.assign({url:e},t);return i.create(n)},e.prototype.request=function(e,t){var n=Object.assign({url:e},t);return rxjs.from(i.request(n))},e.prototype.get=function(e,t){return rxjs.from(i.get(e,t))},e.prototype.delete=function(e,t){return rxjs.from(i.delete(e,t))},e.prototype.head=function(e,t){return rxjs.from(i.head(e,t))},e.prototype.post=function(e,t){return rxjs.from(i.post(e,t))},e.prototype.put=function(e,t){return rxjs.from(i.put(e,t))},e.prototype.patch=function(e,t){return rxjs.from(i.patch(e,t))},e.prototype.createRequestInterceptor=function(e,t){return i.interceptors.request.use(e,t)},e.prototype.removeRequestInterceptor=function(e){i.interceptors.request.eject(e)},e.prototype.createResponseInterceptor=function(e,t){return i.interceptors.response.use(e,t)},e.prototype.removeResponseInterceptor=function(e){i.interceptors.response.eject(e)},e=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,n,s):o(t,n))||s);return 3<i&&s&&Object.defineProperty(t,n,s),s}([$()],e)}();t.Utils=o,t.Watcher=a,t.KeyWatcher=c,t.Compile=v,t.CompileUtil=h,t.CompileUtilForRepeat=g,t.Router=V,t.setLocation=function(e,t,n,r){if(R.isBrowser()){var o="/"===this.$vm.$rootPath?"":this.$vm.$rootPath;history.pushState({path:e,query:t,data:n},r,""+o+e+R.buildQuery(t)),this.$vm.$esRouteObject={path:e,query:t,data:n}}},t.getLocation=function(){return R.isBrowser()?{path:this.$vm.$esRouteObject.path,query:this.$vm.$esRouteObject.query,params:this.$vm.$esRouteParmasObject,data:this.$vm.$esRouteObject.data}:{}},t.Component=function(i){return function(e){e.$selector=i.selector,e._injectedComponents=new Map;var t=e.prototype;if(t.$template=i.template,i.providers&&0<i.providers.length){t.$providerList=new Map;for(var n=i.providers.length,r=0;r<n;r++){var o=i.providers[r];o.provide?(o.useClass||o.useValue)&&t.$providerList.set(o.provide,o):t.$providerList.set(o,o)}}t.$components=[],t.$componentList=[],t.watchData=function(){this.state&&(this.nvWatchState&&(this.stateWatcher=new a(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new a(this.state,null,this.reRender.bind(this))))}}},t.setState=function(e){if(e&&T.isFunction(e)){var t=e();if(t&&t instanceof Object){if(T.isEqual(this.state,t))return;var n=JSON.parse(JSON.stringify(this.state));Object.assign(n,t),this.state=n,this.nvWatchState&&(this.stateWatcher=new a(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new a(this.state,null,this.reRender.bind(this))),this.reRender()}}if(e&&e instanceof Object){if(T.isEqual(this.state,e))return;n=JSON.parse(JSON.stringify(this.state)),Object.assign(n,e),this.state=n,this.nvWatchState&&(this.stateWatcher=new a(this.state,this.nvWatchState.bind(this),this.reRender.bind(this))),this.nvWatchState||(this.stateWatcher=new a(this.state,null,this.reRender.bind(this))),this.reRender()}},t.InDiv=S,t.NvModule=function(n){return function(e){e.nvType="nvModule";var t=e.prototype;t.$providerList=new Map,t.$providerInstances=new Map,n.imports&&(t.$imports=n.imports),n.components&&(t.$components=n.components),n.providers&&(t.$providers=n.providers),n.exports&&(t.$exports=n.exports,t.$exportsList=[]),n.bootstrap&&(t.$bootstrap=n.bootstrap)}},t.factoryModule=_,t.NVHttp=P,t.HttpClient=k,t.Injectable=$,t.Injected=function(t){var e=Reflect.getMetadata("design:paramtypes",t);e&&e.length&&e.forEach(function(e){if(e===t)throw new Error("不可以依赖自身");t._needInjectedClass?t._needInjectedClass.push(e):t._needInjectedClass=[e]})},t.injector=w,t.factoryCreator=C}),bundle$1=unwrapExports(bundle),bundle_1=bundle.Utils,bundle_2=bundle.Watcher,bundle_3=bundle.KeyWatcher,bundle_4=bundle.Compile,bundle_5=bundle.CompileUtil,bundle_6=bundle.CompileUtilForRepeat,bundle_7=bundle.Router,bundle_8=bundle.setLocation,bundle_9=bundle.getLocation,bundle_10=bundle.Component,bundle_11=bundle.setState,bundle_12=bundle.InDiv,bundle_13=bundle.NvModule,bundle_14=bundle.factoryModule,bundle_15=bundle.NVHttp,bundle_16=bundle.HttpClient,bundle_17=bundle.Injectable,bundle_18=bundle.Injected,bundle_19=bundle.injector,bundle_20=bundle.factoryCreator;exports.default=bundle$1,exports.Utils=bundle_1,exports.Watcher=bundle_2,exports.KeyWatcher=bundle_3,exports.Compile=bundle_4,exports.CompileUtil=bundle_5,exports.CompileUtilForRepeat=bundle_6,exports.Router=bundle_7,exports.setLocation=bundle_8,exports.getLocation=bundle_9,exports.Component=bundle_10,exports.setState=bundle_11,exports.InDiv=bundle_12,exports.NvModule=bundle_13,exports.factoryModule=bundle_14,exports.NVHttp=bundle_15,exports.HttpClient=bundle_16,exports.Injectable=bundle_17,exports.Injected=bundle_18,exports.injector=bundle_19,exports.factoryCreator=bundle_20;
